<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recetario Ligero</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <div class="max-w-7xl mx-auto p-6">
    <header class="mb-6 text-center">
      <h1 class="text-4xl font-bold text-amber-600">Recetario Ligero</h1>
      <p class="text-gray-600">120 recetas para inspirar tu cocina.</p>
    </header>

    <!-- CONTROLES -->
    <div class="flex flex-col sm:flex-row gap-3 mb-4 items-center">
      <input id="search" type="text" placeholder="Buscar receta..."
        class="flex-1 p-3 rounded-full border focus:outline-none focus:ring-2 focus:ring-amber-400" />
      <button id="btn-all" class="px-4 py-2 bg-amber-500 text-white rounded-full">Todas</button>
      <button id="btn-fav" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full">Favoritas</button>
      <button id="btn-cart" class="px-4 py-2 bg-teal-500 text-white rounded-full">
        Carrito (<span id="cart-count">0</span>)
      </button>
    </div>

    <div id="no-results" class="hidden text-center py-12 text-gray-500">
      No se encontró ninguna receta.
    </div>

    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
  </div>

  <!-- MODAL RECETA -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative">
      <button id="close-modal" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800">✕</button>
      <h2 id="modal-title" class="text-2xl font-bold text-amber-600 mb-4"></h2>
      <img id="modal-img" class="w-full h-48 object-cover rounded-lg mb-4" />
      <p class="mb-4">
        <strong>Tiempo:</strong> <span id="modal-time"></span> |
        <strong>Raciones:</strong> <span id="modal-serv"></span>
      </p>
      <div class="flex items-center gap-2 mb-4 justify-center">
        <button id="dec-serv" class="px-3 py-1 bg-amber-100 rounded-md">−</button>
        <input id="inp-serv" type="number" min="1" class="w-16 text-center border rounded" value="1" />
        <button id="inc-serv" class="px-3 py-1 bg-amber-100 rounded-md">+</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-2">Ingredientes</h3>
          <ul id="ing-list" class="list-disc list-inside space-y-1 text-gray-700"></ul>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Pasos</h3>
          <ol id="step-list" class="list-decimal list-inside space-y-2 text-gray-700"></ol>
        </div>
      </div>
      <div class="mt-6 flex flex-wrap gap-3 justify-center">
        <button id="add-cart" class="bg-teal-600 text-white px-6 py-2 rounded-full">Añadir al Carrito</button>
        <button id="start-cook" class="bg-green-600 text-white px-6 py-2 rounded-full">Modo Cocina</button>
      </div>
    </div>
  </div>

  <!-- MODO COCINA -->
  <div id="cook-mode" class="fixed inset-0 bg-white hidden flex-col items-center justify-center p-6 z-50">
    <div id="step-counter" class="text-xl font-semibold text-amber-600 mb-4"></div>
    <div id="step-text" class="text-2xl text-gray-800 mb-6 text-center"></div>
    <div class="flex gap-4">
      <button id="prev-step" class="px-4 py-2 bg-gray-200 rounded">Anterior</button>
      <button id="repeat-step" class="px-4 py-2 bg-amber-400 text-white rounded">Repetir</button>
      <button id="next-step" class="px-4 py-2 bg-gray-200 rounded">Siguiente</button>
    </div>
    <button id="exit-cook" class="absolute top-4 right-4 px-3 py-1 bg-red-400 text-white rounded">✕</button>
  </div>

  <!-- CARRITO -->
  <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6 relative">
      <button id="close-cart" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800">✕</button>
      <h2 class="text-2xl font-bold text-teal-600 mb-4">Tu Carrito</h2>
      <ul id="cart-list" class="list-disc list-inside space-y-2 text-gray-700"></ul>
      <div class="mt-4 text-center">
        <button id="clear-cart" class="bg-red-500 text-white px-6 py-2 rounded-full">Vaciar Carrito</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>

  <script>
    // === DATOS ===
    // Pega aquí tu array original con las 120 recetas:
    const allRecipes = [ /* ... tus 120 objetos de receta ... */ ];

    // === ESTADO ===
    let favs = new Set();
    let cart = [];
    let filtered = allRecipes.slice();
    let currentRecipe = null;
    let cookSteps = [], cookIndex = 0;

    // === REFERENCIAS DOM ===
    const grid = document.getElementById('grid'),
          noRes = document.getElementById('no-results'),
          btnAll = document.getElementById('btn-all'),
          btnFav = document.getElementById('btn-fav'),
          btnCart = document.getElementById('btn-cart'),
          cartCount = document.getElementById('cart-count'),
          searchInput = document.getElementById('search'),
          modal = document.getElementById('modal'),
          mTitle = document.getElementById('modal-title'),
          mImg = document.getElementById('modal-img'),
          mTime = document.getElementById('modal-time'),
          mServ = document.getElementById('modal-serv'),
          decServ = document.getElementById('dec-serv'),
          incServ = document.getElementById('inc-serv'),
          inpServ = document.getElementById('inp-serv'),
          ingList = document.getElementById('ing-list'),
          stepList = document.getElementById('step-list'),
          addCart = document.getElementById('add-cart'),
          startCook = document.getElementById('start-cook'),
          closeModal = document.getElementById('close-modal'),
          cookMode = document.getElementById('cook-mode'),
          stepCounter = document.getElementById('step-counter'),
          stepText = document.getElementById('step-text'),
          prevStep = document.getElementById('prev-step'),
          nextStep = document.getElementById('next-step'),
          repeatStep = document.getElementById('repeat-step'),
          exitCook = document.getElementById('exit-cook'),
          cartModal = document.getElementById('cart-modal'),
          cartList = document.getElementById('cart-list'),
          closeCart = document.getElementById('close-cart'),
          clearCart = document.getElementById('clear-cart'),
          toastC = document.getElementById('toast-container');

    // === RENDER ===
    function renderList(){
      grid.innerHTML = '';
      const list = filtered;
      if(!list.length){ noRes.classList.remove('hidden'); return }
      noRes.classList.add('hidden');

      list.forEach(r=>{
        const c = document.createElement('div');
        c.className = 'bg-white rounded-xl shadow hover:shadow-lg transition flex flex-col cursor-pointer';
        c.innerHTML = `
          <img src="${r.imagen}" alt="${r.titulo}"
               class="h-32 w-full object-cover rounded-t-xl">
          <div class="p-4 flex-grow flex flex-col">
            <h2 class="font-semibold text-lg">${r.titulo}</h2>
            <p class="text-sm text-gray-500 mt-1">Tiempo: ${r.tiempo}</p>
            <div class="mt-auto flex justify-between items-center">
              <button class="fav-btn text-${favs.has(r.titulo)?'red':'gray'}-500">♥</button>
              <button class="view-btn text-blue-500">Ver →</button>
            </div>
          </div>`;
        c.onclick = ()=> openModal(r);
        c.querySelector('.fav-btn').onclick = e=>{
          e.stopPropagation();
          if(favs.has(r.titulo)) favs.delete(r.titulo), toast('Eliminado de favoritos');
          else favs.add(r.titulo), toast('Añadido a favoritos','success');
          renderList();
        };
        grid.appendChild(c);
      });
    }

    // === FILTROS ===
    function applyFilter(mode){
      if(mode==='all') filtered = allRecipes.slice();
      else filtered = allRecipes.filter(r=>favs.has(r.titulo));
      const term = searchInput.value.toLowerCase();
      if(term) filtered = filtered.filter(r=>
        r.titulo.toLowerCase().includes(term) ||
        r.ingredientes.join(' ').toLowerCase().includes(term)
      );
      renderList();
    }
    btnAll.onclick  = ()=>{ applyFilter('all'); };
    btnFav.onclick  = ()=>{ applyFilter('fav'); };
    searchInput.oninput = ()=>applyFilter();

    // === MODAL RECETA ===
    function openModal(r){
      currentRecipe = r;
      mTitle.textContent = r.titulo;
      mImg.src = r.imagen;
      mTime.textContent = r.tiempo;
      inpServ.value = r.raciones;
      mServ.textContent = r.raciones;
      // ingredientes
      ingList.innerHTML = '';
      r.ingredientes.forEach(i=>{
        const li = document.createElement('li');
        li.textContent = i; ingList.appendChild(li);
      });
      // pasos
      stepList.innerHTML = '';
      r.pasos.forEach(p=>{
        const li=document.createElement('li');
        li.textContent=p; stepList.appendChild(li);
      });
      modal.classList.remove('hidden');
    }
    closeModal.onclick = ()=>modal.classList.add('hidden');
    decServ.onclick = ()=>{
      let v = Math.max(1, parseInt(inpServ.value)-1);
      inpServ.value = v; mServ.textContent = v;
    };
    incServ.onclick = ()=>{
      let v = parseInt(inpServ.value)+1;
      inpServ.value = v; mServ.textContent = v;
    };

    // === CARRITO ===
    addCart.onclick = ()=>{
      const qty = parseInt(inpServ.value);
      cart.push({r:currentRecipe.titulo,n:qty});
      cartCount.textContent = cart.length;
      toast(`Añadido ${qty} raciones de "${currentRecipe.titulo}" al carrito`,'success');
    };
    btnCart.onclick = ()=>cartModal.classList.remove('hidden');
    closeCart.onclick = ()=>cartModal.classList.add('hidden');
    clearCart.onclick = ()=>{
      cart = []; cartCount.textContent=0; cartList.innerHTML='';
      toast('Carrito vaciado','info');
    };
    function renderCart(){
      cartList.innerHTML='';
      if(!cart.length) cartList.innerHTML='<li>Carrito vacío</li>';
      else cart.forEach((it,i)=>{
        const li=document.createElement('li');
        li.textContent=`${it.n} × ${it.r}`;
        cartList.appendChild(li);
      });
    }
    cartModal.addEventListener('transitionend',renderCart);

    // === MODO COCINA / VOZ ===
    exitCook.onclick = ()=>{ cookMode.classList.add('hidden'); window.speechSynthesis.cancel(); };
    function startCooking(){
      cookSteps = currentRecipe.pasos.slice();
      cookIndex = 0;
      cookMode.classList.remove('hidden');
      showStep();
      startVoice();
    }
    startCook.onclick = startCooking;
    function showStep(){
      stepCounter.textContent = `Paso ${cookIndex+1} de ${cookSteps.length}`;
      stepText.textContent = cookSteps[cookIndex];
      speak(cookSteps[cookIndex]);
    }
    prevStep.onclick = ()=>{
      if(cookIndex>0){ cookIndex--; showStep(); } else speak('Estás en el primer paso');
    };
    nextStep.onclick = ()=>{
      if(cookIndex<cookSteps.length-1){ cookIndex++; showStep(); }
      else{ speak('Receta completada'); exitCook.onclick(); }
    };
    repeatStep.onclick = ()=>showStep();

    // voz
    const SpeechRecognition = window.SpeechRecognition||window.webkitSpeechRecognition;
    let recog=null, listening=false, speaking=false;
    function speak(txt){
      speechSynthesis.cancel();
      const u=new SpeechSynthesisUtterance(txt);
      u.lang='es-ES'; u.rate=0.9;
      u.onend=()=>speaking=false;
      u.onstart=()=>speaking=true;
      speechSynthesis.speak(u);
    }
    function startVoice(){
      if(!SpeechRecognition) return;
      if(!recog){
        recog=new SpeechRecognition();
        recog.lang='es-ES'; recog.interimResults=false;
        recog.onresult=e=>{
          const cmd=e.results[0][0].transcript.toLowerCase();
          if(speaking) return;
          if(cmd.includes('siguiente')) nextStep.onclick();
          else if(cmd.includes('anterior')) prevStep.onclick();
          else if(cmd.includes('repetir')) repeatStep.onclick();
          else if(cmd.includes('salir')) exitCook.onclick();
          else speak('Di siguiente, anterior, repetir o salir');
        };
        recog.onend=()=>{ if(!cookMode.classList.contains('hidden')) recog.start(); };
      }
      if(!listening){ recog.start(); listening=true; }
    }

    // === TOAST ===
    function toast(msg,type='info'){
      const d=document.createElement('div');
      d.className=`px-4 py-2 rounded shadow text-white ${{
        info:'bg-blue-500',success:'bg-green-500',error:'bg-red-500'
      }[type]||'bg-gray-500'}`;
      d.textContent=msg; toastC.appendChild(d);
      setTimeout(()=>{
        d.remove();
      },3000);
    }

    // === INIT ===
    renderList();
  </script>

</body>
</html>
