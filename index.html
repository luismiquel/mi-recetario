<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Recetario Delicioso (150 recetas) ‚Äì Accesible</title>

<!-- Manifest simple inline (opcional) -->
<link rel="manifest" href='data:application/manifest+json,{"name":"Recetario Delicioso","short_name":"Recetario","start_url":".","display":"standalone","background_color":"#f8f7f5","theme_color":"#78350f","icons":[{"src":"https://placehold.co/192x192/78350f/fff?text=R","sizes":"192x192","type":"image/png"},{"src":"https://placehold.co/512x512/78350f/fff?text=R","sizes":"512x512","type":"image/png"}]}' />

<style>
:root{
  --bg:#f8f7f5; --fg:#1c1917; --accent:#78350f; --accent2:#f59e0b; --muted:#6b7280;
  --card:#ffffff; --card-dark:#2b2b2b; --radius:20px;
  --font-base:18px; --font-large:22px; --font-xlarge:26px;
}
html{font-size:var(--font-base);}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--fg);}
.dark body{background:#111;color:#e5e5e5;}
a{color:var(--accent);}
h1,h2,h3,h4{font-family:Georgia, 'Times New Roman', serif;margin:0;}
header{padding:1.5rem 1rem 1rem;text-align:center;position:relative;}
#skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;}
#skip:focus{position:static;width:auto;height:auto;background:#fff;padding:.5rem;z-index:1000;}
#top-controls{position:sticky;top:0;background:rgba(248,247,245,.9);backdrop-filter:blur(6px);z-index:10;padding:.5rem 0;border-bottom:1px solid #ddd;}
.dark #top-controls{background:rgba(28,25,23,.9);border-color:#333;}
.btn{cursor:pointer;border:none;border-radius:9999px;padding:.6rem 1rem;font-size:.85rem;transition:.2s;line-height:1;}
.btn:hover{opacity:.9;}
.btn-ghost{background:transparent;border:1px solid transparent;}
.btn-chip{background:#eee;color:#333;margin:.2rem;}
.dark .btn-chip{background:#3b3735;color:#ddd;}
.btn-chip.active{background:var(--accent);color:#fff;font-weight:600;box-shadow:0 2px 5px rgba(0,0,0,.2);}
.dark .btn-chip.active{background:var(--accent2);color:#111;}
#searchInput{width:100%;padding:.8rem 2.5rem .8rem 2.5rem;border:1px solid #ccc;border-radius:9999px;}
.dark #searchInput{background:#222;border-color:#444;color:#eee;}
#recipeGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;padding:1rem;}
.recipe-card{outline:none;}
.recipe-card>div{background:var(--card);border-radius:var(--radius);overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,.08);display:flex;flex-direction:column;height:100%;transition:.2s;}
.dark .recipe-card>div{background:var(--card-dark);}
.recipe-card>div:hover{transform:translateY(-3px);}
.recipe-card img{width:100%;height:140px;object-fit:cover;}
.badge{position:absolute;top:.5rem;left:.5rem;background:var(--accent);color:#fff;font-size:.7rem;padding:.25rem .5rem;border-radius:9999px;}
.dark .badge{background:var(--accent2);color:#111;}
.favorite-btn{position:absolute;top:.5rem;right:.5rem;background:rgba(255,255,255,.85);border-radius:50%;padding:.3rem;border:none;cursor:pointer;}
.dark .favorite-btn{background:rgba(0,0,0,.5);}
.favorite-btn svg{width:22px;height:22px;stroke-width:2;}
.card-body{padding:0.8rem;flex:1;display:flex;flex-direction:column;}
.card-title{font-size:1rem;font-weight:700;margin-bottom:.3rem;color:var(--accent);}
.dark .card-title{color:var(--accent2);}
.card-meta{font-size:.8rem;color:var(--muted);margin-top:auto;}
#no-results{text-align:center;padding:2rem;color:var(--muted);display:none;}

#recipeModal,#cookingMode{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.65);z-index:100;}
.modal-visible{display:flex;}
.modal-panel{background:var(--card);color:var(--fg);width:95%;max-width:760px;max-height:92vh;overflow-y:auto;border-radius:24px;padding:1.2rem 1.4rem 2rem;position:relative;box-shadow:0 20px 40px rgba(0,0,0,.35);transform:scale(.96);transition:.25s;}
.dark .modal-panel{background:#1f1f1f;color:#eee;}
.modal-visible .modal-panel{transform:scale(1);}
.close-btn{position:absolute;top:.6rem;right:.6rem;background:#eee;border:none;border-radius:50%;padding:.4rem;cursor:pointer;}
.dark .close-btn{background:#333;color:#eee;}
h2.modal-title{margin:0 2.5rem 1rem 0;font-size:1.6rem;line-height:1.2;}
.modal-img{width:100%;max-height:280px;object-fit:cover;border-radius:16px;margin-bottom:1rem;}
.section-title{font-size:1.2rem;border-bottom:2px solid #f0d9b5;margin:1.2rem 0 .6rem;padding-bottom:.3rem;}
.dark .section-title{border-color:#5c3b14;}
ul,ol{margin:0;padding-left:1.1rem;}
#portionBox{display:flex;align-items:center;gap:.5rem;margin:.5rem 0 1rem;font-size:.9rem;}
.adjust-btn{padding:.3rem .7rem;border-radius:8px;border:1px solid #ccc;background:#fafafa;cursor:pointer;}
.dark .adjust-btn{background:#333;border-color:#555;color:#eee;}
#servingsInput{width:60px;text-align:center;padding:.2rem .3rem;border:1px solid #ccc;border-radius:8px;}
.dark #servingsInput{background:#333;border-color:#555;color:#eee;}

.modal-actions{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:center;margin-top:1.2rem;}
.modal-actions .btn{box-shadow:0 2px 5px rgba(0,0,0,.15);font-weight:600;}
#shoppingDrawer{position:fixed;right:0;top:0;bottom:0;width:320px;background:var(--card);box-shadow:-3px 0 15px rgba(0,0,0,.25);transform:translateX(100%);transition:.3s;padding:1rem 1.2rem 2rem;z-index:90;overflow-y:auto;}
.dark #shoppingDrawer{background:#1f1f1f;color:#eee;}
#shoppingDrawer.open{transform:translateX(0);}
#shoppingList{font-size:.9rem;margin-bottom:1rem;}
#shoppingList li{margin:.3rem 0;display:flex;align-items:center;gap:.4rem;}
#shoppingList input[type="checkbox"]{transform:scale(1.2);}
.drawer-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem;}
.drawer-title{margin:0;font-size:1.1rem;}
#ttsToggle,#contrastToggle,#fontInc,#fontDec{margin-left:.3rem;}
#aria-live{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;}
/* High contrast mode */
.high-contrast{--bg:#000;--fg:#fff;--card:#000;--card-dark:#000;--accent:#ffd800;--accent2:#ffd800;--muted:#ccc;}
.high-contrast a{color:#ffd800;}
/* Cooking mode */
#cookingMode{flex-direction:column;background:var(--bg);color:var(--fg);}
#cookingStepText{font-size:2rem;max-width:90%;text-align:center;line-height:1.35;}
#cookControls{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;padding:1rem;width:100%;max-width:600px;margin:0 auto;}
#cookControls button{padding:1rem;border-radius:14px;border:none;font-size:1rem;font-weight:600;cursor:pointer;}
.print-only{display:none;}
@media print{
  body *{visibility:hidden;}
  #recipeModal,#recipeModal *{visibility:visible;}
  #recipeModal{position:absolute;inset:0;background:none;}
  .close-btn,.modal-actions,#portionBox{display:none!important;}
  .print-only{display:block;}
}
</style>
</head>
<body>
<a href="#main" id="skip">Saltar al contenido principal</a>

<div id="aria-live" aria-live="polite"></div>

<header>
  <h1>Recetario Delicioso</h1>
  <p id="subtitle">150 recetas para inspirar tu cocina</p>
  <small id="sessionInfo" aria-live="polite"></small>
</header>

<div id="top-controls" aria-label="Controles principales">
  <div style="max-width:1100px;margin:0 auto;padding:0 .8rem;">
    <div style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;">
      <div style="position:relative;flex:1;">
        <input id="searchInput" type="search" aria-label="Buscar por nombre o ingrediente" placeholder="Buscar por nombre o ingrediente‚Ä¶" />
        <span style="position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:1.1rem;opacity:.5;">üîç</span>
      </div>
      <button id="filterAll" class="btn btn-chip active" aria-pressed="true">Todas</button>
      <button id="filterFav" class="btn btn-chip" aria-pressed="false">Favoritas</button>
      <button id="openShopping" class="btn btn-chip" aria-haspopup="true" aria-controls="shoppingDrawer">üõí Lista</button>
      <button id="contrastToggle" class="btn btn-chip" title="Alto contraste">Alto contraste</button>
      <button id="fontDec" class="btn btn-chip" title="Reducir tama√±o de letra">A-</button>
      <button id="fontInc" class="btn btn-chip" title="Aumentar tama√±o de letra">A+</button>
      <button id="ttsToggle" class="btn btn-chip" title="Leer en voz alta">üîà Voz</button>
    </div>
    <div id="catFilters" style="margin-top:.6rem;overflow-x:auto;white-space:nowrap;padding-bottom:.3rem;">
      <button class="btn btn-chip active" data-cat="all">Todos</button>
      <button class="btn btn-chip" data-cat="Aperitivo">Aperitivos</button>
      <button class="btn btn-chip" data-cat="Primero">Primeros</button>
      <button class="btn btn-chip" data-cat="Segundo">Segundos</button>
      <button class="btn btn-chip" data-cat="Postre">Postres</button>
    </div>
  </div>
</div>

<main id="main">
  <div id="no-results">No se encontraron recetas.</div>
  <section id="recipeGrid" aria-label="Listado de recetas"></section>
</main>

<!-- Modal Receta -->
<div id="recipeModal" role="dialog" aria-modal="true" aria-labelledby="recipeTitle">
  <div class="modal-panel" role="document">
    <button class="close-btn" id="closeModal" aria-label="Cerrar">‚úñ</button>
    <h2 id="recipeTitle" class="modal-title"></h2>
    <img id="recipeImg" class="modal-img" alt="">
    <p id="recipeTime" style="font-weight:600;margin:.3rem 0;"></p>
    <div id="portionBox">
      <span>Raciones:</span>
      <button class="adjust-btn" id="decServ" aria-label="Reducir raciones">-</button>
      <input id="servingsInput" type="number" min="1" aria-label="Raciones" />
      <button class="adjust-btn" id="incServ" aria-label="Aumentar raciones">+</button>
    </div>
    <h3 class="section-title">Ingredientes</h3>
    <ul id="ingredientList"></ul>

    <h3 class="section-title">Pasos</h3>
    <ol id="stepsList"></ol>

    <div class="modal-actions">
      <button class="btn" id="addToShopping">A√±adir a la lista üõí</button>
      <button class="btn" id="startCooking">Modo cocina guiada ‚ñ∂Ô∏è</button>
      <button class="btn" id="printRecipe">Imprimir</button>
      <button class="btn" id="shareRecipe">Compartir</button>
    </div>
    <div class="print-only">
      <p><strong>www.</strong></p>
    </div>
  </div>
</div>

<!-- Drawer Lista Compra -->
<aside id="shoppingDrawer" aria-label="Lista de la compra">
  <div class="drawer-header">
    <h4 class="drawer-title">Lista de la compra</h4>
    <button id="closeShopping" class="btn btn-ghost" aria-label="Cerrar lista">‚úñ</button>
  </div>
  <ul id="shoppingList"></ul>
  <div style="display:flex;gap:.4rem;flex-wrap:wrap;">
    <button id="copyShopping" class="btn">Copiar</button>
    <button id="clearChecked" class="btn">Borrar marcados</button>
    <button id="clearAll" class="btn">Vaciar</button>
    <button id="printShopping" class="btn">Imprimir</button>
  </div>
</aside>

<!-- Cooking Mode -->
<div id="cookingMode" role="dialog" aria-modal="true">
  <button id="exitCooking" class="btn btn-chip" style="position:absolute;top:10px;right:10px;">Salir ‚úñ</button>
  <p id="cookCounter" style="margin-top:70px;font-weight:600;"></p>
  <div id="cookingStepText"></div>
  <div id="cookControls">
    <button id="cookPrev">Anterior</button>
    <button id="cookRepeat">Repetir</button>
    <button id="cookNext">Siguiente</button>
  </div>
</div>

<footer style="text-align:center;padding:1rem;border-top:1px solid #ddd;margin-top:2rem;">
  <p style="margin:.3rem 0;font-size:.8rem;">&copy; <span id="year"></span> Luis Miguel Garcia De Las Morenas. Todos los derechos reservados.</p>
</footer>

<script>
/* ========= DATA ========= */
const recipes = [
/* -----------------  A P E R I T I V O S  (38) ----------------- */
{categoria:"Aperitivo",titulo:"Brochetas de aceituna y pimiento",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brochetas+Aceituna",ingredientes:["Aceitunas verdes y negras","Pimiento rojo troceado","Hojas de albahaca","Aceite de oliva","Pimienta negra"],pasos:["Ensarta aceitunas, pimiento y albahaca en palillos.","Ali√±a con aceite y pimienta.","Sirve fr√≠o."]},
{categoria:"Aperitivo",titulo:"Garbanzos crujientes al horno",raciones:2,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Garbanzos+Crujientes",ingredientes:["200 g garbanzos cocidos","1 cda. AOVE","1/2 cdita piment√≥n ahumado","1/4 cdita comino","Sal"],pasos:["Mezcla garbanzos con aceite y especias.","Hornea 35 min a 180 ¬∞C.","Enfr√≠a y sirve."]},
{categoria:"Aperitivo",titulo:"Hummus cl√°sico con crudit√©s",raciones:4,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Hummus+Crudites",ingredientes:["400 g garbanzos cocidos","2 cdas. tahini","1 diente de ajo","Zumo de 1 lim√≥n","Aceite de oliva","Palitos de zanahoria y apio"],pasos:["Tritura los garbanzos con tahini, ajo, lim√≥n y aceite.","Sirve con los crudit√©s."]},
{categoria:"Aperitivo",titulo:"Guacamole r√°pido",raciones:3,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Guacamole+Rapido",ingredientes:["2 aguacates","1/2 cebolla morada","1 tomate peque√±o","Zumo de 1 lima","Sal","Nachos integrales"],pasos:["Tritura el aguacate con cebolla, tomate y lima.","Sirve con nachos."]},
{categoria:"Aperitivo",titulo:"Rollitos de jam√≥n y esp√°rragos",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Rollitos+Jamon+Esparragos",ingredientes:["5 lonchas de jam√≥n serrano","5 esp√°rragos verdes cocidos","Aceite de oliva"],pasos:["Enrolla cada esp√°rrago con jam√≥n.","Roc√≠a aceite y sirve."]},
{categoria:"Aperitivo",titulo:"Chips de kale al horno",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Chips+Kale+Horno",ingredientes:["Hojas de kale","1 cda. aceite de oliva","Sal marina"],pasos:["Lava y seca hojas.","Ali√±a y hornea 15 min a 150 ¬∞C."]},
{categoria:"Aperitivo",titulo:"Dip de yogur y pepino",raciones:4,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Dip+Yogur+Pepino",ingredientes:["1 yogur natural","1/2 pepino rallado","1 diente de ajo","Hierbabuena","Sal y pimienta"],pasos:["Mezcla todo y sirve fr√≠o."]},
{categoria:"Aperitivo",titulo:"Tomates cherry rellenos de queso",raciones:3,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tomates+Rellenos+Queso",ingredientes:["Tomates cherry","Queso crema light","Cebollino"],pasos:["Corta tapa a tomates.","Rellena con queso y cebollino."]},
{categoria:"Aperitivo",titulo:"Tostadas integrales con aguacate",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tostadas+Aguacate",ingredientes:["2 tostadas integrales","1 aguacate","Zumo de lim√≥n","Sal y pimienta"],pasos:["Tritura aguacate con lim√≥n y sal.","Unta y a√±ade pimienta."]},
{categoria:"Aperitivo",titulo:"Mini tortillas de espinaca",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Mini+Tortillas+Espinaca",ingredientes:["2 huevos","Espinacas frescas","1 cda. queso rallado light","Sal"],pasos:["Bate huevos, a√±ade espinaca y queso.","Cuaja en sart√©n peque√±a."]},
{categoria:"Aperitivo",titulo:"Palitos de zanahoria al horno",raciones:3,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Palitos+Zanahoria+Horno",ingredientes:["2 zanahorias","1 cda. aceite de oliva","Pimienta","Piment√≥n"],pasos:["Corta en tiras, condimenta y hornea 25 min 180¬∞C."]},
{categoria:"Aperitivo",titulo:"Edamame con sal y lim√≥n",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Edamame+Sal+Limon",ingredientes:["200 g edamame","Sal marina","Zumo de lim√≥n"],pasos:["Hierve 5 min, escurre y ali√±a."]},
{categoria:"Aperitivo",titulo:"Tostas de hummus y tomate seco",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tostas+Hummus+Tomate",ingredientes:["2 tostadas integrales","2 cdas. hummus","Tomate seco"],pasos:["Unta hummus y decora con tomate seco."]},
{categoria:"Aperitivo",titulo:"Aceitunas marinadas caseras",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Aceitunas+Marinadas",ingredientes:["Aceitunas verdes","Aceite de oliva","Ajo","Or√©gano"],pasos:["Mezcla todo y reposa 1 h."]},
{categoria:"Aperitivo",titulo:"Gazpacho ligero de remolacha",raciones:4,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gazpacho+Remolacha",ingredientes:["3 tomates","1 remolacha cocida","1/2 pepino","Ajo","Aceite","Vinagre","Sal"],pasos:["Tritura todo y sirve fr√≠o."]},
{categoria:"Aperitivo",titulo:"Canap√©s de salm√≥n y queso crema",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Canapes+Salmon",ingredientes:["Pan tostado","Salm√≥n ahumado","Queso crema light","Eneldo"],pasos:["Unta queso, coloca salm√≥n y eneldo."]},
{categoria:"Aperitivo",titulo:"Crema fr√≠a de aguacate",raciones:3,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Aguacate",ingredientes:["2 aguacates","Zumo de 1 lima","Caldo verduras fr√≠o","Cilantro","Sal"],pasos:["Tritura aguacate con caldo y lima."]},
{categoria:"Aperitivo",titulo:"Bastones de pepino con hummus",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pepino+Hummus",ingredientes:["1 pepino","Hummus"],pasos:["Corta pepino y sirve con hummus."]},
{categoria:"Aperitivo",titulo:"Chips de batata al horno",raciones:3,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Chips+Batata+Horno",ingredientes:["1 batata","1 cda. aceite","Piment√≥n dulce","Sal"],pasos:["Corta fino, ali√±a y hornea a 180¬∞C."]},
{categoria:"Aperitivo",titulo:"Brochetas Caprese mini",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brochetas+Caprese",ingredientes:["Tomates cherry","Mozzarella mini","Albahaca","AOVE","Bals√°mico"],pasos:["Ensarta tomate, queso y albahaca.","Ali√±a."]},
{categoria:"Aperitivo",titulo:"Pat√© de berenjena (Baba Ghanoush)",raciones:4,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pate+Berenjena",ingredientes:["1 berenjena","2 cdas. tahini","Zumo 1/2 lim√≥n","1 ajo","Aceite","Comino","Sal","Perejil"],pasos:["Asa berenjena, retira pulpa y tritura todo."]},
{categoria:"Aperitivo",titulo:"Rollitos de calabac√≠n y queso",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Rollitos+Calabacin",ingredientes:["1 calabac√≠n","100 g queso fresco batido","Menta","Sal y pimienta"],pasos:["Laminas de calabac√≠n a la plancha.","Rellena y enrolla."]},
{categoria:"Aperitivo",titulo:"Pincho de tortilla de patatas",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pincho+Tortilla",ingredientes:["2 huevos","1 patata","1/4 cebolla","Aceite","Sal"],pasos:["Haz tortilla peque√±a y corta en pinchos."]},
{categoria:"Aperitivo",titulo:"Vasitos de gazpacho con langostinos",raciones:4,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Vasitos+Gazpacho",ingredientes:["2 tomates","1/4 pepino","1/4 pimiento","Ajo","Aceite","Vinagre","Sal","8 langostinos"],pasos:["Haz gazpacho, sirve en vasitos y decora."]},
{categoria:"Aperitivo",titulo:"Brochetas de pollo satay mini",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brochetas+Pollo+Satay",ingredientes:["150 g pollo","1 cda. salsa cacahuete","1/2 cdita curry"],pasos:["Marina pollo, ensarta y plancha."]},
/* extras aperitivo */
{categoria:"Aperitivo",titulo:"Bruschetta de tomate y albahaca",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Bruschetta",ingredientes:["Pan tostado","Tomate","Ajo","Albahaca","Aceite","Sal"],pasos:["Frota ajo en pan, a√±ade tomate ali√±ado y albahaca."]},
{categoria:"Aperitivo",titulo:"Ensaladilla rusa ligera",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensaladilla",ingredientes:["Patata cocida","Zanahoria","Guisantes","At√∫n","Yogur+mostaza"],pasos:["Cuece verduras, mezcla con at√∫n y salsa de yogur."]},
{categoria:"Aperitivo",titulo:"Pan con tomate (pa amb tom√†quet)",raciones:2,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pan+Tomate",ingredientes:["Pan","Tomate maduro","Aceite","Sal"],pasos:["Frota tomate en pan, ali√±a con aceite y sal."]},
{categoria:"Aperitivo",titulo:"Aceitunas ali√±adas con c√≠tricos",raciones:4,tiempo:"10 min + reposo",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Aceitunas+Citrico",ingredientes:["Aceitunas mixtas","Ralladura lim√≥n","Naranja","Ajo","AOVE"],pasos:["Mezcla todo y deja reposar."]},
{categoria:"Aperitivo",titulo:"Sardinas marinadas r√°pidas",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sardinas",ingredientes:["Sardinas limpias","Vinagre","AOVE","Ajo","Perejil"],pasos:["Marina sardinas en vinagre/aceite y sirve."]},
{categoria:"Aperitivo",titulo:"Gazpachuelo malague√±o ligero",raciones:4,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gazpachuelo",ingredientes:["Caldo pescado","Patata","Mayonesa ligera","Lim√≥n"],pasos:["Cuece patata en caldo, monta mayonesa con caldo y lim√≥n."]},
{categoria:"Aperitivo",titulo:"Pimientos del padr√≥n a la plancha",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pimientos+Padron",ingredientes:["Pimientos padr√≥n","AOVE","Sal gruesa"],pasos:["Plancha pimientos y espolvorea sal."]},
{categoria:"Aperitivo",titulo:"Mejillones en escabeche casero",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Mejillones",ingredientes:["Mejillones","Vinagre","AOVE","Laurel","Piment√≥n"],pasos:["Cuece mejillones y cubre con escabeche."]},
{categoria:"Aperitivo",titulo:"Patatas ali√±adas andaluzas",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Patatas+Ali√±adas",ingredientes:["Patatas cocidas","Cebolla","Perejil","AOVE","Vinagre","Sal"],pasos:["Corta patatas, ali√±a y enfr√≠a."]},
{categoria:"Aperitivo",titulo:"Tartar de tomate y aguacate",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tartar+Tomate",ingredientes:["Tomate","Aguacate","Cebolla","Cilantro","Lim√≥n"],pasos:["Pica y mezcla en capas, ali√±a."]},
{categoria:"Aperitivo",titulo:"Crema fr√≠a de pepino y yogur",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Pepino",ingredientes:["Pepino","Yogur","Menta","Ajo","Sal"],pasos:["Tritura todo y sirve fr√≠o."]},
{categoria:"Aperitivo",titulo:"Tostas de sobrasada y miel",raciones:2,tiempo:"8 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sobrasada+Miel",ingredientes:["Tostas","Sobrasada","Miel"],pasos:["Unta sobrasada, roc√≠a miel y gratina ligeramente."]},
{categoria:"Aperitivo",titulo:"Queso manchego con membrillo",raciones:4,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Queso+Membrillo",ingredientes:["Queso manchego","Dulce de membrillo"],pasos:["Corta y monta peque√±os bocados."]},
{categoria:"Aperitivo",titulo:"Pinchos de anchoa y aceituna (Gilda)",raciones:4,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gilda",ingredientes:["Anchoas","Aceitunas","Guindilla"],pasos:["Ensarta aceituna, guindilla y anchoa."]},
/* -----------------  P R I M E R O S  (38) ----------------- */
{categoria:"Primero",titulo:"Ensalada de quinoa con verduras",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Quinoa",ingredientes:["1 taza quinoa cocida","Pimiento rojo y verde","Tomates cherry","Cebolla morada","Aceite","Lim√≥n"],pasos:["Mezcla quinoa con verduras.","Ali√±a."]},
{categoria:"Primero",titulo:"Sopa de lentejas rojas",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Lentejas+Rojas",ingredientes:["1 taza lentejas rojas","1 zanahoria","1 cebolla","1 ajo","1 cdita comino","Sal/pimienta"],pasos:["Sofr√≠e base, a√±ade lentejas y agua.","Cocina 20 min y tritura si quieres."]},
{categoria:"Primero",titulo:"Crema de calabaza",raciones:4,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Calabaza",ingredientes:["500 g calabaza","1 puerro","1 patata","Aceite","Sal","Nuez moscada"],pasos:["Cuece verduras y tritura con aceite."]},
{categoria:"Primero",titulo:"Ensalada de garbanzos mediterr√°nea",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Garbanzos",ingredientes:["400 g garbanzos","Pepino","Tomate","Cebolla morada","Aceitunas","Lim√≥n","Aceite"],pasos:["Mezcla todo y ali√±a."]},
{categoria:"Primero",titulo:"Gazpacho andaluz tradicional",raciones:4,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gazpacho+Andaluz",ingredientes:["1 kg tomates","1 pepino","1/2 pimiento verde","1 ajo","Aceite","Vinagre jerez","Sal"],pasos:["Tritura y sirve fr√≠o."]},
{categoria:"Primero",titulo:"Tabul√© de bulgur con hierbas",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tabule+Bulgur",ingredientes:["1 taza bulgur cocido","Tomate","Pepino","Cebolla","Lim√≥n","Menta","Perejil","Aceite","Sal"],pasos:["Pica y mezcla con bulgur y ali√±o."]},
{categoria:"Primero",titulo:"Crema de zanahoria y jengibre",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Zanahoria",ingredientes:["4 zanahorias","1 patata","Jengibre fresco","Aceite","Sal/pimienta"],pasos:["Cuece y tritura."]},
{categoria:"Primero",titulo:"Ensalada de lentejas con vinagreta",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Lentejas",ingredientes:["1 taza lentejas cocidas","Pimiento rojo","Zanahoria","Cebolla","Mostaza","Aceite","Vinagre"],pasos:["Haz vinagreta, mezcla con lentejas y verduras."]},
{categoria:"Primero",titulo:"Sopa miso con tofu y algas",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Miso",ingredientes:["750 ml agua","1 cda miso","Tofu","Alga wakame","Cebolleta"],pasos:["Disuelve miso sin hervir, a√±ade tofu y alga."]},
{categoria:"Primero",titulo:"Crema de espinacas cremosa",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Espinacas",ingredientes:["200 g espinacas","1 patata","1 puerro peque√±o","500 ml caldo","Aceite","Sal"],pasos:["Sofr√≠e puerro, a√±ade espinaca y patata, cuece y tritura."]},
{categoria:"Primero",titulo:"Ensalada de arroz integral y at√∫n",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Arroz",ingredientes:["1 taza arroz integral","1 lata at√∫n","Ma√≠z","Tomates cherry","Pepino","Aceite","Vinagre"],pasos:["Mezcla todo y ali√±a."]},
{categoria:"Primero",titulo:"Sopa de pollo y fideos",raciones:4,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Pollo",ingredientes:["1 l caldo pollo","100 g fideos","Pollo cocido","Zanahoria","Apio"],pasos:["Hierve verduras, a√±ade pollo y fideos."]},
{categoria:"Primero",titulo:"Pur√© de patata y calabac√≠n",raciones:3,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pure+Patata",ingredientes:["2 patatas","1 calabac√≠n","50 ml leche","Sal","Nuez moscada"],pasos:["Cuece, tritura y ajusta."]},
{categoria:"Primero",titulo:"Ensalada C√©sar ligera",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Cesar+Ligera",ingredientes:["Lechuga romana","Pollo plancha","Picatostes integrales","Parmesano light","Salsa C√©sar light"],pasos:["Mezcla todo con la salsa."]},
{categoria:"Primero",titulo:"Crema de champi√±ones",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Champis",ingredientes:["300 g champi√±ones","1 cebolla","500 ml caldo","1 cda maicena","Aceite","Perejil"],pasos:["Sofr√≠e, a√±ade caldo y maicena, tritura."]},
{categoria:"Primero",titulo:"Salmorejo cordob√©s",raciones:4,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Salmorejo",ingredientes:["1 kg tomates","200 g pan","1 ajo","100 ml AOVE","Sal","Huevo/jam√≥n opcional"],pasos:["Remoja pan, tritura todo y emulsiona con aceite."]},
{categoria:"Primero",titulo:"Ensalada de pasta integral con verduras",raciones:3,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Pasta",ingredientes:["200 g pasta integral","Pimiento rojo","Ma√≠z","Aceitunas","Tomates cherry","Aceite","Or√©gano"],pasos:["Cuece pasta, enfr√≠a y mezcla con verduras."]},
{categoria:"Primero",titulo:"Sopa de verduras casera",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Verduras",ingredientes:["Zanahoria","Puerro","Patata","Jud√≠as verdes","Caldo","Sal/pimienta"],pasos:["Corta y cuece todo."]},
{categoria:"Primero",titulo:"Crema de guisantes con menta",raciones:3,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Guisantes",ingredientes:["300 g guisantes","1 cebolleta","Menta","Caldo","Aceite"],pasos:["Sofr√≠e cebolleta, a√±ade guisantes y caldo, tritura con menta."]},
{categoria:"Primero",titulo:"Ensalada de remolacha y queso de cabra",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Remolacha",ingredientes:["2 remolachas","100 g queso cabra","Nueces","R√∫cula","Vinagreta miel/mostaza"],pasos:["Monta la ensalada y ali√±a."]},
{categoria:"Primero",titulo:"Crema de esp√°rragos verdes",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Esparragos",ingredientes:["500 g esp√°rragos","1 patata","1 cebolla","Caldo","Nata ligera opc.","Sal/pimienta"],pasos:["Sofr√≠e, cuece, tritura y cuela."]},
{categoria:"Primero",titulo:"Sopa de ajo castellana",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Ajo",ingredientes:["4 ajos","4 rebanadas pan","1 cdita piment√≥n","Caldo","Aceite","Huevo opc."],pasos:["Sofr√≠e ajo y pan, a√±ade piment√≥n y caldo."]},
{categoria:"Primero",titulo:"Ensalada de cusc√∫s con pasas y pi√±ones",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Cuscus",ingredientes:["1 taza cusc√∫s","Pasas","Pi√±ones","Pepino","Tomate","Aceite","Lim√≥n","Menta"],pasos:["Hidrata cusc√∫s y mezcla con todo."]},
{categoria:"Primero",titulo:"Crema de calabac√≠n y manzana",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Calabacin",ingredientes:["2 calabacines","1 manzana","1/2 cebolla","Caldo","Aceite","Sal"],pasos:["Sofr√≠e, cuece y tritura."]},
{categoria:"Primero",titulo:"Salpic√≥n de marisco ligero",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Salpicon",ingredientes:["Gambas","Pulpo","Cebolla morada","Pimiento rojo","Perejil","Aceite","Vinagre","Sal"],pasos:["Pica y mezcla con ali√±o."]},
/* extras primeros */
{categoria:"Primero",titulo:"Vichyssoise cl√°sica",raciones:4,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Vichyssoise",ingredientes:["Puerros","Patata","Caldo","Nata ligera","Sal"],pasos:["Cuece puerros y patata, tritura y a√±ade nata."]},
{categoria:"Primero",titulo:"Crema de puerros y manzana",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Puerros+Manzana",ingredientes:["Puerros","Manzana","Caldo","Aceite","Sal"],pasos:["Sofr√≠e, cuece y tritura."]},
{categoria:"Primero",titulo:"Ensalada templada de setas",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Setas",ingredientes:["Setas variadas","Lechugas","Ajo","Aceite","Vinagre"],pasos:["Saltea setas y mezcla con hojas y ali√±o."]},
{categoria:"Primero",titulo:"Sopa minestrone r√°pida",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Minestrone",ingredientes:["Verduras mixtas","Legumbres","Pasta corta","Caldo","Tomate"],pasos:["Cuece todo por etapas hasta que est√© tierno."]},
{categoria:"Primero",titulo:"Gazpacho de sand√≠a",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gazpacho+Sandia",ingredientes:["Sand√≠a","Tomate","Pepino","Aceite","Vinagre","Sal"],pasos:["Tritura y sirve fr√≠o."]},
{categoria:"Primero",titulo:"Ensalada de jud√≠as verdes y huevo",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Judias+Huevo",ingredientes:["Jud√≠as verdes","Huevo duro","Tomate","Aceite","Vinagre","Sal"],pasos:["Cuece jud√≠as, mezcla con huevo y ali√±o."]},
{categoria:"Primero",titulo:"Crema de coliflor y curry",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Coliflor+Curry",ingredientes:["Coliflor","Curry","Caldo","Leche evaporada light"],pasos:["Cuece coliflor, tritura con curry y leche."]},
{categoria:"Primero",titulo:"Sopa fr√≠a de mel√≥n y menta",raciones:4,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Melon",ingredientes:["Mel√≥n","Menta","Yogur opc.","Sal"],pasos:["Tritura y enfr√≠a."]},
{categoria:"Primero",titulo:"Ensalada de tomate, mozzarela y pesto",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tomate+Pesto",ingredientes:["Tomate","Mozzarella","Pesto","Albahaca"],pasos:["Monta y ali√±a con pesto."]},
{categoria:"Primero",titulo:"Crema de boniato",raciones:4,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Boniato",ingredientes:["Boniato","Cebolla","Caldo","Sal","Pimienta"],pasos:["Cuece y tritura."]},
{categoria:"Primero",titulo:"Ensalada griega",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ensalada+Griega",ingredientes:["Tomate","Pepino","Cebolla","Aceitunas","Queso feta","Aceite","Or√©gano"],pasos:["Corta y ali√±a."]},
{categoria:"Primero",titulo:"Sopa de tomate asado",raciones:4,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sopa+Tomate",ingredientes:["Tomates","Cebolla","Ajo","Caldo","Aceite"],pasos:["Asa tomates y tritura con caldo."]},
{categoria:"Primero",titulo:"Crema de apio y pera",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crema+Apio",ingredientes:["Apio","Pera","Patata","Caldo"],pasos:["Cuece y tritura."]},
/* -----------------  S E G U N D O S  (37) ----------------- */
{categoria:"Segundo",titulo:"Pollo al horno con lim√≥n y hierbas",raciones:2,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pollo+Limon",ingredientes:["2 pechugas pollo","1 lim√≥n","Tomillo","Romero","Aceite","Sal/pimienta"],pasos:["Marina y hornea 25 min a 200¬∞C."]},
{categoria:"Segundo",titulo:"Salm√≥n a la plancha con esp√°rragos",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Salmon+Esparragos",ingredientes:["2 lomos salm√≥n","Esp√°rragos verdes","Aceite","Sal","Pimienta"],pasos:["Plancha salm√≥n y esp√°rragos."]},
{categoria:"Segundo",titulo:"Wok de ternera y br√≥coli",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ternera+Brocoli",ingredientes:["200 g ternera","1 br√≥coli","Soja baja sodio","Jengibre","Aceite s√©samo"],pasos:["Saltea ternera, a√±ade br√≥coli y ali√±a."]},
{categoria:"Segundo",titulo:"Pavo a la plancha con pur√© de manzana",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pavo+Manzana",ingredientes:["2 filetes pavo","2 manzanas","Canela","Sal"],pasos:["Plancha pavo y sirve con pur√© de manzana."]},
{categoria:"Segundo",titulo:"Merluza en salsa verde",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Merluza+Verde",ingredientes:["2 lomos merluza","Ajo","Perejil","Vino blanco","Caldo pescado","Guisantes"],pasos:["Salsa verde y merluza 10 min."]},
{categoria:"Segundo",titulo:"Berenjenas rellenas de carne picada",raciones:2,tiempo:"50 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Berenjenas+Carne",ingredientes:["2 berenjenas","200 g carne pavo","Cebolla","Tomate triturado","Queso light"],pasos:["Asa berenjena, rellena y gratina."]},
{categoria:"Segundo",titulo:"Tofu salteado con verduras",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tofu+Verduras",ingredientes:["200 g tofu","Pimiento","Calabac√≠n","Cebolla","Soja"],pasos:["Saltea todo."]},
{categoria:"Segundo",titulo:"Pechuga de pollo a la naranja",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pollo+Naranja",ingredientes:["2 pechugas","Zumo de 2 naranjas","1 cdita maicena","Sal/pimienta"],pasos:["Dora pollo, a√±ade zumo con maicena."]},
{categoria:"Segundo",titulo:"At√∫n a la plancha con ensalada",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Atun+Plancha",ingredientes:["2 filetes at√∫n","Tomates cherry","R√∫cula","Vinagre bals√°mico"],pasos:["Plancha at√∫n y acompa√±a con ensalada."]},
{categoria:"Segundo",titulo:"Solomillo de cerdo con champi√±ones",raciones:2,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Solomillo+Cerdo",ingredientes:["1 solomillo cerdo","Champi√±ones","Cebolla","Nata ligera","Sal/pimienta"],pasos:["Sella carne, haz salsa y sirve."]},
{categoria:"Segundo",titulo:"Lasa√±a de verduras ligera",raciones:4,tiempo:"60 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Lasagna+Verduras",ingredientes:["L√°minas integrales","Calabac√≠n","Berenjena","Pimiento","Tomate triturado","Queso light"],pasos:["Monta y hornea."]},
{categoria:"Segundo",titulo:"Bacalao con sofrito de tomate",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Bacalao+Tomate",ingredientes:["2 lomos bacalao desal.","Cebolla","Tomate triturado","Aceite","Sal"],pasos:["Sofr√≠e tomate, a√±ade bacalao."]},
{categoria:"Segundo",titulo:"Curry de garbanzos y espinacas",raciones:3,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Curry+Garbanzos",ingredientes:["400 g garbanzos","200 g espinacas","Cebolla","Leche coco light","Curry"],pasos:["Sofr√≠e, a√±ade garbanzos, coco y espinacas."]},
{categoria:"Segundo",titulo:"Sepia a la plancha con alioli suave",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sepia+Plancha",ingredientes:["1 sepia","Ajo","Perejil","Aceite","Lim√≥n","Alioli ligero"],pasos:["Plancha sepia y sirve con majado."]},
{categoria:"Segundo",titulo:"Hamburguesas de pollo caseras",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Burger+Pollo",ingredientes:["300 g pollo picado","1/2 cebolla","Huevo","Pan rallado","Especias"],pasos:["Mezcla, forma y plancha."]},
{categoria:"Segundo",titulo:"Dorada al papillote con verduras",raciones:1,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Dorada+Papillote",ingredientes:["1 dorada","Verduras variadas","Aceite","Hierbas","Sal/pimienta"],pasos:["Hornea en papillote 20-25 min."]},
{categoria:"Segundo",titulo:"Muslos de pollo con arroz integral",raciones:2,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Muslos+Arroz",ingredientes:["2 muslos pollo","1 taza arroz integral","Caldo","Cebolla","Pimiento","Aceite"],pasos:["Dora pollo, sofr√≠e arroz y verduras, cuece."]},
{categoria:"Segundo",titulo:"Calabacines rellenos de arroz y verduras",raciones:2,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Calabacin+Relleno",ingredientes:["2 calabacines","Arroz cocido","Champi√±ones","Tomate triturado","Queso light"],pasos:["Vac√≠a, rellena y gratina."]},
{categoria:"Segundo",titulo:"Pinchos de gambas y pi√±a",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gambas+Pina",ingredientes:["Gambas","Pi√±a","Aceite","Piment√≥n","Lim√≥n"],pasos:["Ensarta y plancha."]},
{categoria:"Segundo",titulo:"Huevos revueltos con esp√°rragos y setas",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Huevos+Setas",ingredientes:["3 huevos","Esp√°rragos trigueros","Setas","Aceite","Sal/pimienta"],pasos:["Saltea verduras y a√±ade huevos."]},
{categoria:"Segundo",titulo:"Alb√≥ndigas de pollo en salsa de tomate",raciones:3,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Albondigas+Pollo",ingredientes:["300 g pollo picado","1/2 cebolla","Pan rallado","1 huevo","Tomate triturado","Or√©gano"],pasos:["Forma alb√≥ndigas, dora y cuece en salsa."]},
{categoria:"Segundo",titulo:"Pescado al horno con patatas panaderas",raciones:2,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pescado+Patatas",ingredientes:["2 filetes pescado blanco","2 patatas","1 cebolla","Aceite","Sal","Perejil"],pasos:["Hornea patatas+cebolla, a√±ade pescado."]},
{categoria:"Segundo",titulo:"Champi√±ones rellenos de verduras",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Champis+Rellenos",ingredientes:["8 champi√±ones","1/2 pimiento","1/2 cebolla","Pulpa champi√±√≥n","Queso light"],pasos:["Rellena y gratina."]},
{categoria:"Segundo",titulo:"Brochetas de verduras a la parrilla",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brochetas+Verduras",ingredientes:["Calabac√≠n","Berenjena","Pimiento","Cebolla","Tomates cherry","Aceite","Hierbas"],pasos:["Ensarta, ali√±a y asa."]},
{categoria:"Segundo",titulo:"Pollo estilo oriental con arroz basmati",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pollo+Oriental",ingredientes:["200 g pollo","Pimiento rojo","Cebolla","Soja","Jengibre","Arroz basmati"],pasos:["Saltea pollo y verduras con soja y jengibre."]},
/* extras segundos */
{categoria:"Segundo",titulo:"Filete de ternera a la plancha con chimichurri",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Ternera+Chimi",ingredientes:["Filetes ternera","Perejil","Ajo","Vinagre","Aceite"],pasos:["Plancha carne y sirve con chimichurri."]},
{categoria:"Segundo",titulo:"Bacalao al pil-pil ligero",raciones:2,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pilpil",ingredientes:["Bacalao desalado","Ajo","Aceite","Guindilla"],pasos:["Confita ajo, liga con el bacalao."]},
{categoria:"Segundo",titulo:"Pechugas rellenas de espinacas y queso",raciones:2,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pechuga+Rellena",ingredientes:["Pechugas","Espinacas","Queso light","Sal/pimienta"],pasos:["Rellena, cierra y hornea/plancha."]},
{categoria:"Segundo",titulo:"Tortilla francesa con verduras",raciones:1,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tortilla+Verduras",ingredientes:["2 huevos","Verduras picadas","Sal"],pasos:["Saltea verduras, a√±ade huevo y cuaja."]},
{categoria:"Segundo",titulo:"Pisto manchego con huevo",raciones:2,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pisto",ingredientes:["Tomate","Calabac√≠n","Berenjena","Pimiento","Cebolla","Huevos"],pasos:["Cuece verduras lentamente, sirve con huevo."]},
{categoria:"Segundo",titulo:"Conejo al ajillo",raciones:3,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Conejo+Ajillo",ingredientes:["Conejo troceado","Ajo","Vino blanco","Aceite","Perejil"],pasos:["Dora conejo con ajo, desglasa con vino."]},
{categoria:"Segundo",titulo:"Calamares a la plancha con lim√≥n",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Calamares",ingredientes:["Calamares","Aceite","Lim√≥n","Perejil"],pasos:["Plancha calamares y ali√±a."]},
{categoria:"Segundo",titulo:"Alb√≥ndigas de lentejas",raciones:3,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Alb%C3%B3ndigas+Lentejas",ingredientes:["Lentejas cocidas","Avena","Cebolla","Especias","Tomate triturado"],pasos:["Forma alb√≥ndigas veganas y cocina en salsa."]},
{categoria:"Segundo",titulo:"Tacos de pescado",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tacos+Pescado",ingredientes:["Pescado blanco","Tortillas ma√≠z","Col rallada","Yogur-lima"],pasos:["Plancha pescado y sirve en tacos."]},
{categoria:"Segundo",titulo:"Costillas de cerdo al horno light",raciones:3,tiempo:"60 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Costillas",ingredientes:["Costillas","Especias","Mostaza-miel"],pasos:["Marina y hornea lentamente."]},
{categoria:"Segundo",titulo:"Seit√°n salteado con verduras",raciones:2,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Seitan",ingredientes:["Seit√°n","Verduras mixtas","Soja","S√©samo"],pasos:["Saltea todo r√°pido."]},
{categoria:"Segundo",titulo:"Huevos al plato con tomate",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Huevos+Plato",ingredientes:["Huevos","Tomate triturado","Pimiento","Guisantes"],pasos:["Cuece salsa y hornea huevos dentro."]},
/* -----------------  P O S T R E S  (37) ----------------- */
{categoria:"Postre",titulo:"Brochetas de fruta fresca",raciones:4,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brochetas+Fruta",ingredientes:["Fresas","Kiwi","Mel√≥n","Uvas"],pasos:["Corta y ensarta."]},
{categoria:"Postre",titulo:"Yogur natural con miel y nueces",raciones:1,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Yogur+Miel",ingredientes:["1 yogur","1 cdita miel","Nueces"],pasos:["Mezcla en un bol."]},
{categoria:"Postre",titulo:"Manzana asada con canela",raciones:1,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Manzana+Canela",ingredientes:["1 manzana","Canela"],pasos:["Quita coraz√≥n, espolvorea canela y hornea 30 min."]},
{categoria:"Postre",titulo:"Macedonia de frutas",raciones:3,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Macedonia",ingredientes:["Naranja","Pl√°tano","Manzana","Kiwi","Zumo naranja"],pasos:["Corta y mezcla con zumo."]},
{categoria:"Postre",titulo:"Pl√°tano a la plancha con chocolate",raciones:1,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Platano+Choco",ingredientes:["1 pl√°tano","1 onza chocolate >85%"],pasos:["Plancha pl√°tano y cubre con chocolate."]},
{categoria:"Postre",titulo:"Mousse de aguacate y cacao",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Mousse+Aguacate",ingredientes:["1 aguacate","2 cdas cacao puro","1 cda sirope agave"],pasos:["Tritura y refrigera."]},
{categoria:"Postre",titulo:"Carpaccio de pi√±a con menta",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Carpaccio+Pi%C3%B1a",ingredientes:["Pi√±a","Menta"],pasos:["Lamina y decora."]},
{categoria:"Postre",titulo:"Helado de pl√°tano congelado",raciones:2,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Helado+Platano",ingredientes:["2 pl√°tanos congelados"],pasos:["Tritura hasta textura helado."]},
{categoria:"Postre",titulo:"Peras al vino tinto sin az√∫car",raciones:2,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Peras+Vino",ingredientes:["2 peras","1 vaso vino tinto","Canela","Edulcorante opc."],pasos:["Cuece peras en vino y reduce."]},
{categoria:"Postre",titulo:"Trufas de aguacate y cacao",raciones:3,tiempo:"20 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Trufas+Aguacate",ingredientes:["1/2 aguacate","2 cdas cacao","1 cda miel","Coco rallado"],pasos:["Mezcla, forma bolitas y reboza."]},
{categoria:"Postre",titulo:"Compota de manzana casera",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Compota+Manzana",ingredientes:["3 manzanas","Canela","Agua"],pasos:["Cuece hasta blandas y tritura."]},
{categoria:"Postre",titulo:"Fresas con yogur y ch√≠a",raciones:1,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Fresas+Yogur",ingredientes:["Fresas","Yogur","Ch√≠a"],pasos:["Mezcla y sirve."]},
{categoria:"Postre",titulo:"Naranja con canela",raciones:1,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Naranja+Canela",ingredientes:["1 naranja","Canela"],pasos:["Corta y espolvorea canela."]},
{categoria:"Postre",titulo:"Bombones de d√°tiles y almendras",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Datiles+Almendras",ingredientes:["4 d√°tiles","8 almendras","Cacao polvo"],pasos:["Rellena d√°tiles y reboza en cacao."]},
{categoria:"Postre",titulo:"Pudding de ch√≠a con frutos rojos",raciones:2,tiempo:"10 min (+2h)",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pudding+Chia",ingredientes:["2 cdas ch√≠a","1/2 taza leche vegetal","1/2 taza frutos rojos"],pasos:["Hidrata ch√≠a, sirve con frutos rojos."]},
{categoria:"Postre",titulo:"Melocot√≥n a la plancha con helado",raciones:1,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Melocoton+Helado",ingredientes:["1 melocot√≥n","Canela","Helado light opc."],pasos:["Plancha melocot√≥n y acompa√±a."]},
{categoria:"Postre",titulo:"Sorbete de fresa natural",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Sorbete+Fresa",ingredientes:["250 g fresas congeladas","Zumo 1/2 lim√≥n","1 cda miel"],pasos:["Tritura hasta sorbete."]},
{categoria:"Postre",titulo:"Bol de a√ßa√≠ con granola",raciones:1,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Acai+Granola",ingredientes:["Pulpa a√ßa√≠","Pl√°tano","Leche vegetal","Granola","Fruta"],pasos:["Tritura base y decora."]},
{categoria:"Postre",titulo:"Galletas de avena y pl√°tano",raciones:3,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Galletas+Avena",ingredientes:["1 pl√°tano","1/2 taza avena","Chips chocolate opc."],pasos:["Mezcla, forma y hornea 15 min 180¬∞C."]},
{categoria:"Postre",titulo:"Yogur con compota y frutos secos",raciones:1,tiempo:"5 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Yogur+Compota",ingredientes:["Yogur","Compota manzana","Frutos secos"],pasos:["Monta en capas."]},
{categoria:"Postre",titulo:"Flan de huevo light",raciones:4,tiempo:"50 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Flan+Light",ingredientes:["3 huevos","500 ml leche desnatada","Edulcorante","Vainilla"],pasos:["Ba√±o mar√≠a hasta cuajar."]},
{categoria:"Postre",titulo:"Gelatina de frutas variadas",raciones:4,tiempo:"20 min + fr√≠o",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Gelatina+Frutas",ingredientes:["Gelatina sin az√∫car","Frutas picadas","Agua"],pasos:["Prepara gelatina y a√±ade frutas."]},
{categoria:"Postre",titulo:"Bizcocho de lim√≥n sin az√∫car",raciones:6,tiempo:"45 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Bizcocho+Limon",ingredientes:["3 huevos","150 g harina integral","Zumo/ralladura 1 lim√≥n","Edulcorante","Levadura","50 ml aceite suave"],pasos:["Mezcla y hornea 30 min 180¬∞C."]},
{categoria:"Postre",titulo:"Vasitos de yogur con granola y frutas",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Vasitos+Yogur",ingredientes:["Yogur","Granola","Fruta"],pasos:["Alterna capas."]},
{categoria:"Postre",titulo:"Tarta de queso individual sin horno",raciones:1,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tarta+Queso",ingredientes:["100 g queso crema light","2 cdas yogur griego","1 cda miel","Galleta integral","Frutos rojos"],pasos:["Base de galleta, mezcla queso y decora."]},
/* extras postres */
{categoria:"Postre",titulo:"Mousse de yogur y frutos rojos",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Mousse+Yogur",ingredientes:["Yogur griego","Clara montada","Frutos rojos","Edulcorante"],pasos:["Mezcla suave y enfr√≠a."]},
{categoria:"Postre",titulo:"Crepes integrales con fruta",raciones:2,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Crepes",ingredientes:["Harina integral","Leche","Huevo","Fruta"],pasos:["Haz crepes y rellena con fruta."]},
{categoria:"Postre",titulo:"Natillas ligeras de vainilla",raciones:4,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Natillas",ingredientes:["Leche desnatada","Yemas","Maicena","Vainilla","Edulcorante"],pasos:["Cuece sin hervir hasta espesar."]},
{categoria:"Postre",titulo:"Peras al microondas con canela",raciones:2,tiempo:"8 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Peras+Micro",ingredientes:["Peras","Canela"],pasos:["Microondas hasta tiernas."]},
{categoria:"Postre",titulo:"Arroz con leche light",raciones:4,tiempo:"40 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Arroz+Leche",ingredientes:["Arroz","Leche desnatada","Canela","Edulcorante","Lim√≥n"],pasos:["Cuece lento removiendo."]},
{categoria:"Postre",titulo:"Tarta de manzana r√°pida",raciones:4,tiempo:"30 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Tarta+Manzana",ingredientes:["Manzana","Hojaldre ligero","Canela","Edulcorante"],pasos:["Coloca manzana en masa y hornea."]},
{categoria:"Postre",titulo:"Brownie de cacao y calabac√≠n",raciones:6,tiempo:"35 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Brownie",ingredientes:["Calabac√≠n rallado","Cacao puro","Huevo","Avena"],pasos:["Mezcla y hornea hasta cuajar."]},
{categoria:"Postre",titulo:"Compota de pera y jengibre",raciones:4,tiempo:"25 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Compota+Pera",ingredientes:["Peras","Jengibre","Agua"],pasos:["Cuece y tritura."]},
{categoria:"Postre",titulo:"Yogur helado casero",raciones:4,tiempo:"5 min + congelar",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Yogur+Helado",ingredientes:["Yogur griego","Miel","Fruta"],pasos:["Congela y bate para cremosidad."]},
{categoria:"Postre",titulo:"Macedonia con hierbabuena",raciones:3,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Macedonia+Menta",ingredientes:["Frutas variadas","Hierbabuena","Zumo naranja"],pasos:["Mezcla todo y enfr√≠a."]},
{categoria:"Postre",titulo:"Panna cotta ligera",raciones:4,tiempo:"20 min + fr√≠o",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Pannacotta",ingredientes:["Leche","Gelatina","Vainilla","Edulcorante"],pasos:["Hidrata gelatina, mezcla caliente y cuaja."]},
{categoria:"Postre",titulo:"Trifle de frutas y yogur",raciones:2,tiempo:"10 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Trifle",ingredientes:["Bizcocho light","Yogur","Fruta"],pasos:["Alterna capas en vaso."]},
{categoria:"Postre",titulo:"Mousse de mango",raciones:2,tiempo:"15 min",imagen:"https://placehold.co/800x600/d1c4b5/4a2e0a?text=Mousse+Mango",ingredientes:["Mango","Yogur","Gelatina opc."],pasos:["Tritura mango con yogur."]},
];

const TOTAL_RECIPES = recipes.length;
/* ========= STATE ========= */
let favorites = JSON.parse(localStorage.getItem("favorites")||"[]");
let shopping = JSON.parse(localStorage.getItem("shopping")||"[]");
let currentFilter = "all"; // all or favorites
let currentCategory = "all";
let currentRecipe = null;
let currentServings = 0;
let speechEnabled = false;
let cookingSteps = [];
let cookingIndex = 0;

/* ========= DOM ========= */
const d = document;
const grid = d.getElementById("recipeGrid");
const searchInput = d.getElementById("searchInput");
const filterAllBtn = d.getElementById("filterAll");
const filterFavBtn = d.getElementById("filterFav");
const catFilters = d.getElementById("catFilters");
const noResults = d.getElementById("no-results");
const yearSpan = d.getElementById("year");
const ariaLive = d.getElementById("aria-live");
yearSpan.textContent = new Date().getFullYear();
d.getElementById("subtitle").textContent = TOTAL_RECIPES+" recetas para inspirar tu cocina";

/* Modal */
const modal = d.getElementById("recipeModal");
const modalPanel = modal.querySelector(".modal-panel");
const recipeTitle = d.getElementById("recipeTitle");
const recipeImg = d.getElementById("recipeImg");
const recipeTime = d.getElementById("recipeTime");
const ingredientList = d.getElementById("ingredientList");
const stepsList = d.getElementById("stepsList");
const closeModalBtn = d.getElementById("closeModal");
const decServ = d.getElementById("decServ");
const incServ = d.getElementById("incServ");
const servingsInput = d.getElementById("servingsInput");
const addToShoppingBtn = d.getElementById("addToShopping");
const startCookingBtn = d.getElementById("startCooking");
const printRecipeBtn = d.getElementById("printRecipe");
const shareRecipeBtn = d.getElementById("shareRecipe");

/* Shopping Drawer */
const shoppingDrawer = d.getElementById("shoppingDrawer");
const openShoppingBtn = d.getElementById("openShopping");
const closeShoppingBtn = d.getElementById("closeShopping");
const shoppingList = d.getElementById("shoppingList");
const copyShoppingBtn = d.getElementById("copyShopping");
const clearCheckedBtn = d.getElementById("clearChecked");
const clearAllBtn = d.getElementById("clearAll");
const printShoppingBtn = d.getElementById("printShopping");

/* Accessibility toggles */
const contrastToggle = d.getElementById("contrastToggle");
const fontInc = d.getElementById("fontInc");
const fontDec = d.getElementById("fontDec");
const ttsToggle = d.getElementById("ttsToggle");

/* Cooking mode */
const cookingMode = d.getElementById("cookingMode");
const cookCounter = d.getElementById("cookCounter");
const cookingStepText = d.getElementById("cookingStepText");
const cookPrev = d.getElementById("cookPrev");
const cookRepeat = d.getElementById("cookRepeat");
const cookNext = d.getElementById("cookNext");
const exitCooking = d.getElementById("exitCooking");

/* ========= RENDER ========= */
function renderRecipes(list){
  grid.innerHTML = "";
  if(list.length===0){ noResults.style.display="block"; return; }
  noResults.style.display="none";
  const frag = d.createDocumentFragment();
  list.forEach(r=>{
    const card = d.createElement("div");
    card.className="recipe-card";
    card.tabIndex=0;
    card.setAttribute("role","button");
    card.setAttribute("aria-label",r.titulo);
    card.dataset.id = r.titulo;

    card.innerHTML=`
      <div>
        <div class="badge">${r.categoria}</div>
        <button class="favorite-btn" aria-label="Marcar favorito">
          <svg viewBox="0 0 24 24" fill="${favorites.includes(r.titulo)?'currentColor':'none'}" stroke="${favorites.includes(r.titulo)?'red':'currentColor'}"><path d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"/></svg>
        </button>
        <img src="${r.imagen}" alt="Imagen de ${r.titulo}" onerror="this.src='https://placehold.co/600x400/d1c4b5/4a2e0a?text=Receta'">
        <div class="card-body">
          <h3 class="card-title">${r.titulo}</h3>
          <p class="card-meta">Tiempo: ${r.tiempo} ¬∑ Raciones: ${r.raciones}</p>
        </div>
      </div>`;
    frag.appendChild(card);
  });
  grid.appendChild(frag);
}

function applyFilters(){
  const term = searchInput.value.toLowerCase();
  const list = recipes.filter(r=>{
    const matchesTerm = term==="" || (r.titulo.toLowerCase()+" "+r.ingredientes.join(" ").toLowerCase()).includes(term);
    const matchesFav = currentFilter!=="favorites" || favorites.includes(r.titulo);
    const matchesCat = currentCategory==="all" || r.categoria===currentCategory;
    return matchesTerm && matchesFav && matchesCat;
  });
  renderRecipes(list);
}

renderRecipes(recipes);

/* ========= EVENTS ========= */
grid.addEventListener("click", e=>{
  const card = e.target.closest(".recipe-card");
  if(!card) return;
  if(e.target.closest(".favorite-btn")){
    toggleFavorite(card.dataset.id);
    return;
  }
  openRecipe(card.dataset.id);
});
grid.addEventListener("keydown", e=>{
  if(e.key==="Enter"||e.key===" "){
    const card = e.target.closest(".recipe-card");
    if(card){ openRecipe(card.dataset.id); e.preventDefault();}
  }
});
function toggleFavorite(id){
  const idx = favorites.indexOf(id);
  if(idx>=0) favorites.splice(idx,1);
  else favorites.push(id);
  localStorage.setItem("favorites",JSON.stringify(favorites));
  applyFilters();
}
filterAllBtn.onclick=()=>{currentFilter="all";filterAllBtn.classList.add("active");filterFavBtn.classList.remove("active");applyFilters();};
filterFavBtn.onclick=()=>{currentFilter="favorites";filterFavBtn.classList.add("active");filterAllBtn.classList.remove("active");applyFilters();};
catFilters.addEventListener("click",e=>{
  const btn = e.target.closest("[data-cat]");
  if(!btn) return;
  currentCategory=btn.dataset.cat;
  catFilters.querySelectorAll(".btn-chip").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  applyFilters();
});
searchInput.addEventListener("input",applyFilters);

/* ========= MODAL ========= */
function openRecipe(title){
  const r = recipes.find(x=>x.titulo===title);
  if(!r) return;
  currentRecipe=r;
  currentServings=r.raciones;
  recipeTitle.textContent=r.titulo;
  recipeImg.src=r.imagen;
  recipeImg.alt="Imagen de "+r.titulo;
  recipeTime.textContent="Tiempo: "+r.tiempo;
  servingsInput.value=r.raciones;
  buildIngredientList();
  stepsList.innerHTML=r.pasos.map(p=>`<li>${p}</li>`).join("");
  modal.classList.add("modal-visible");
  modalPanel.focus();
  if(speechEnabled) speak("Mostrando receta "+r.titulo);
}
function closeRecipe(){ modal.classList.remove("modal-visible"); currentRecipe=null; }
closeModalBtn.onclick=closeRecipe;
modal.addEventListener("click",e=>{if(e.target===modal) closeRecipe();});
document.addEventListener("keydown",e=>{ if(e.key==="Escape"){ if(cookingMode.style.display==="flex") exitCookingMode(); else if(modal.classList.contains("modal-visible")) closeRecipe(); }});

/* Servings adjust */
decServ.onclick=()=>{changeServings(-1);};
incServ.onclick=()=>{changeServings(1);};
servingsInput.addEventListener("change",e=>{
  let v=parseInt(e.target.value); if(isNaN(v)||v<1)v=1;
  currentServings=v; buildIngredientList();
});
function changeServings(delta){
  currentServings = Math.max(1,currentServings+delta);
  servingsInput.value=currentServings;
  buildIngredientList();
}
function parseIngredient(str){
  const regex=/^(\d+(?:[.,]\d+)?|\d+\/\d+)?\s*(un|una|medio|media|pu√±ado|chorrito)?\s*(g|gr|gramos|kg|ml|litro|cdita|cda|taza|vaso|trozo|hojas|onza|rebanada|lonchas|lomos|filetes|manojo|piezas|unidad|unidades|latas|cucharadas|cucharaditas|dientes|bolas)?\s*(.+)?$/i;
  const m=str.match(regex);
  if(!m) return {value:0,unit:"",name:str,original:str};
  let val=0;
  if(m[1]){
    if(m[1].includes("/")){const p=m[1].split("/");val=parseFloat(p[0])/parseFloat(p[1]);}
    else val=parseFloat(m[1].replace(",","."));}
  else if(m[2]){val=(m[2].toLowerCase().includes("medio"))?0.5:1;}
  else if(m[4]){val=1;}
  let unit=m[3]?m[3].toLowerCase():"";
  let name=(m[4]||"").trim();
  return {value:val,unit,name,original:str};
}
function formatIngredient(ing,f){
  if(ing.value===0 && !ing.unit) return ing.original;
  let val=ing.value*f,unit=ing.unit,name=ing.name;
  if(unit==="kg"&&val<1){val*=1000;unit="g";}
  if(unit==="litro"&&val<1){val*=1000;unit="ml";}
  if(unit==="g"&&val>=1000){val/=1000;unit="kg";}
  if(unit==="ml"&&val>=1000){val/=1000;unit="litro";}
  val = (Math.round(val*100)/100).toString().replace(".",",");
  if(unit==="cdita"||unit==="cda") return `${val} ${unit}. ${name}`;
  if(val==="1"&&(!unit||["un","una","unidad","pu√±ado","chorrito"].includes(unit))) return name;
  if(unit) return `${val} ${unit} ${name}`.trim();
  return `${val} ${name}`.trim();
}
function buildIngredientList(){
  ingredientList.innerHTML="";
  const factor=currentServings/currentRecipe.raciones;
  currentRecipe.ingredientes.forEach(i=>{
    const p=parseIngredient(i);
    const txt=formatIngredient(p,factor);
    const li=d.createElement("li"); li.textContent=txt; ingredientList.appendChild(li);
  });
}

/* Shopping list */
function saveShopping(){localStorage.setItem("shopping",JSON.stringify(shopping));}
function renderShopping(){
  shoppingList.innerHTML="";
  shopping.forEach((item,i)=>{
    const li=d.createElement("li");
    li.innerHTML=`<input type="checkbox" ${item.done?"checked":""} data-i="${i}"/> <span ${item.done?'style="text-decoration:line-through;opacity:.6"':''}>${item.text}</span>`;
    shoppingList.appendChild(li);
  });
}
shoppingList.addEventListener("change",e=>{
  if(e.target.matches("input[type=checkbox]")){
    const i=e.target.dataset.i;
    shopping[i].done=e.target.checked;
    saveShopping(); renderShopping();
  }
});
addToShoppingBtn.onclick=()=>{
  const factor=currentServings/currentRecipe.raciones;
  currentRecipe.ingredientes.forEach(i=>{
    const p=parseIngredient(i);
    const txt=formatIngredient(p,factor);
    if(!shopping.find(s=>s.text===txt)) shopping.push({text:txt,done:false});
  });
  saveShopping();
  speakLive("A√±adido a la lista");
};
openShoppingBtn.onclick=()=>{shoppingDrawer.classList.add("open");renderShopping();};
closeShoppingBtn.onclick=()=>shoppingDrawer.classList.remove("open");
copyShoppingBtn.onclick=()=>{
  const str=shopping.map(i=>`- ${i.text}${i.done?" ‚úÖ":""}`).join("\n");
  navigator.clipboard.writeText(str).then(()=>speakLive("Lista copiada"));
};
clearCheckedBtn.onclick=()=>{
  shopping=shopping.filter(i=>!i.done);saveShopping();renderShopping();
};
clearAllBtn.onclick=()=>{
  if(confirm("¬øVaciar la lista?")){shopping=[];saveShopping();renderShopping();}
};
printShoppingBtn.onclick=()=>window.print();

/* Share / Print */
printRecipeBtn.onclick=()=>window.print();
shareRecipeBtn.onclick=async()=>{
  if(navigator.share){
    try{await navigator.share({title:currentRecipe.titulo,text:"Mira esta receta",url:location.href});}
    catch(err){}
  }else{
    alert("Tu navegador no soporta compartir.");
  }
};

/* ========= COOKING MODE ========= */
function startCookingMode(){
  cookingSteps=currentRecipe.pasos;
  cookingIndex=0;
  cookingMode.style.display="flex";
  updateCookingStep();
  if(speechEnabled) speak("Empezamos la receta: "+currentRecipe.titulo);
}
function updateCookingStep(){
  cookCounter.textContent=`Paso ${cookingIndex+1} de ${cookingSteps.length}`;
  cookingStepText.textContent=cookingSteps[cookingIndex];
  if(speechEnabled) speak(cookingSteps[cookingIndex]);
}
function exitCookingMode(){
  cookingMode.style.display="none";
  speechSynthesis.cancel();
}
startCookingBtn.onclick=startCookingMode;
exitCooking.onclick=exitCookingMode;
cookPrev.onclick=()=>{ if(cookingIndex>0){cookingIndex--;updateCookingStep();} else speakLive("Primer paso"); };
cookNext.onclick=()=>{ if(cookingIndex<cookingSteps.length-1){cookingIndex++;updateCookingStep();} else {speakLive("Fin de la receta"); exitCookingMode();} };
cookRepeat.onclick=()=>{ if(speechEnabled) speak(cookingSteps[cookingIndex]); };

/* ========= ACCESSIBILITY ========= */
contrastToggle.onclick=()=>{
  document.documentElement.classList.toggle("high-contrast");
};
fontInc.onclick=()=>changeFont(1);
fontDec.onclick=()=>changeFont(-1);
function changeFont(dir){
  const root=getComputedStyle(document.documentElement).fontSize;
  let size=parseFloat(root);
  size = Math.min(24,Math.max(14,size+dir));
  document.documentElement.style.fontSize=size+"px";
}
ttsToggle.onclick=()=>{
  speechEnabled=!speechEnabled;
  ttsToggle.classList.toggle("active",speechEnabled);
  speakLive(speechEnabled?"Voz activada":"Voz desactivada");
};
function speak(text){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="es-ES";u.rate=.9;u.pitch=1;
  speechSynthesis.speak(u);
}
function speakLive(msg){
  ariaLive.textContent=msg;
  if(speechEnabled) speak(msg);
}

/* ====== END ====== */
</script>
</body>
</html>
