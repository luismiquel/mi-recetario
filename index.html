<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recetario Delicioso</title>

    <!-- Metadatos para PWA -->
    <meta name="theme-color" content="#78350f"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Recetario">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/78350f/ffffff?text=R">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{
        &quot;name&quot;: &quot;Recetario Delicioso&quot;,
        &quot;short_name&quot;: &quot;Recetario&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#f8f7f5&quot;,
        &quot;theme_color&quot;: &quot;#78350f&quot;,
        &quot;description&quot;: &quot;Tu app de recetas de cocina española.&quot;,
        &quot;icons&quot;: [{
            &quot;src&quot;: &quot;https://placehold.co/192x192/78350f/ffffff?text=R&quot;,
            &quot;sizes&quot;: &quot;192x192&quot;,
            &quot;type&quot;: &quot;image/png&quot;
        }, {
            &quot;src&quot;: &quot;https://placehold.co/512x512/78350f/ffffff?text=R&quot;,
            &quot;sizes&quot;: &quot;512x512&quot;,
            &quot;type&quot;: &quot;image/png&quot;
        }]
    }">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- Tone.js para sonidos del temporizador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <!-- Estilos personalizados -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f5;
        }
        .dark body {
            background-color: #1c1917;
        }
        h1, h2, h3, h4 {
            font-family: 'Lora', serif;
        }
        .category-btn.active, .filter-btn.active {
            background-color: #78350f;
            color: white;
            font-weight: 600;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .dark .category-btn.active, .dark .filter-btn.active {
            background-color: #f59e0b;
            color: #1c1917;
        }
        .category-btn, .filter-btn {
            transition: all 0.2s ease-in-out;
        }
        #categoryFilters {
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        #categoryFilters::-webkit-scrollbar {
            display: none;
        }
        #categoryFilters .category-btn {
            flex-shrink: 0;
            white-space: nowrap;
        }
        @media print {
            body * { visibility: hidden; }
            #recipeModal, #recipeModal * { visibility: visible; }
            #recipeModal { position: absolute; left: 0; top: 0; width: 100%; height: auto; background: none; }
            #modalContent { box-shadow: none; border: none; max-width: 100%; max-h: none; overflow-y: visible; background-color: white !important; color: black !important; }
            #closeModalBtn, .modal-buttons-container, #add-to-cart-btn, #shareRecipeBtn, #printRecipeBtn, #cookingModeBtn, .timer-btn, #notes-section, #gemini-features { display: none !important; }
            .dark #modalContent, .dark #modalContent * { background-color: white !important; color: black !important; }
            h2, h4 { color: black !important; }
            ul, ol { color: #333 !important; }
            img { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body class="dark:bg-stone-900 dark:text-stone-200">

    <div id="app" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Cabecera -->
        <header class="relative text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-900 dark:text-amber-500">Recetario Delicioso</h1>
            <p class="text-gray-600 dark:text-stone-400 mt-2">80 recetas para inspirar tu cocina.</p>
            <div id="user-info" class="text-xs text-gray-400 mt-2"></div>
            
            <!-- Interruptor Modo Oscuro -->
            <div class="absolute top-0 right-0">
                <button id="theme-toggle" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-stone-700 focus:outline-none">
                    <svg id="theme-toggle-dark-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05A1 1 0 003.636 6.464l.707.707a1 1 0 101.414-1.414l-.707-.707zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zM6.464 16.364l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-1.414-1.414zM13.536 16.364a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414l.707.707z"></path></svg>
                </button>
            </div>
        </header>
        
        <!-- Controles -->
        <div class="sticky top-4 bg-f8f7f5/90 dark:bg-stone-900/90 backdrop-blur-sm z-10 py-4 rounded-xl shadow-sm">
            <div class="flex flex-col sm:flex-row gap-4 mb-4 px-4">
                <div class="relative flex-grow">
                    <input type="text" id="searchInput" placeholder="Buscar por nombre o ingrediente..." class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-stone-600 rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 bg-white dark:bg-stone-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </div>
                <div class="flex items-center justify-center shrink-0 gap-2 bg-amber-100 dark:bg-stone-800 p-1 rounded-full">
                    <button id="filterAll" class="filter-btn px-4 py-2 rounded-full text-sm font-medium">Todas</button>
                    <button id="filterFavorites" class="filter-btn px-4 py-2 rounded-full text-sm font-medium">Favoritas</button>
                </div>
            </div>
            <div id="categoryFilters" class="flex items-center justify-start sm:justify-center gap-2 bg-amber-50 dark:bg-stone-800 p-2 rounded-full mx-4">
                <!-- Botones de categoría -->
            </div>
        </div>

        <div id="no-results" class="hidden text-center py-12">
            <p class="text-gray-600 dark:text-stone-400">No se encontraron recetas. ¡Intenta otra búsqueda o filtro!</p>
        </div>

        <!-- Cuadrícula de Recetas -->
        <div id="recipeGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mt-8">
            <!-- Las recetas se insertan aquí -->
        </div>
    </div>

    <!-- Modals -->
    <div id="recipeModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
        <div id="modalContent" class="bg-white dark:bg-stone-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300"></div>
    </div>
    <div id="shoppingListModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-stone-800 rounded-2xl shadow-xl w-full max-w-md max-h-[90vh] flex flex-col">
            <div class="p-4 border-b dark:border-stone-700 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-amber-900 dark:text-amber-500">Lista de la Compra</h2>
                <button id="closeShoppingListBtn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-stone-700 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="shoppingListContent" class="p-6 overflow-y-auto flex-grow"></div>
            <div class="p-4 border-t dark:border-stone-700">
                <button id="clearShoppingListBtn" class="w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">Limpiar Lista</button>
            </div>
        </div>
    </div>

    <!-- Botón flotante para Lista de la Compra -->
    <button id="shoppingListFAB" class="fixed bottom-6 right-6 bg-amber-800 text-white p-4 rounded-full shadow-lg hover:bg-amber-900 transition transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
    </button>
    
    <!-- Contenedor de Temporizadores Activos -->
    <div id="timers-container" class="fixed bottom-0 left-1/2 -translate-x-1/2 flex gap-2 p-2"></div>


    <!-- Pie de página -->
    <footer class="text-center mt-12 py-4 border-t border-gray-200 dark:border-stone-700">
        <p class="text-sm text-gray-500 dark:text-stone-400">
            &copy; <span id="copyright-year"></span> Luis Miguel Garcia De Las Morenas. Todos los derechos reservados.
        </p>
    </footer>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        function runRecipeApp() {
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "DEMO_KEY", authDomain: "DEMO.firebaseapp.com", projectId: "DEMO_PROJECT" };
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'recetario-delicioso-final';

            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);

            let userFavorites = [], userNotes = {}, shoppingList = [];
            let userId = null;
            let activeTimers = [];
            let currentFilter = 'all', currentCategory = 'all';

            const dom = {
                grid: document.getElementById('recipeGrid'),
                search: document.getElementById('searchInput'),
                filterAllBtn: document.getElementById('filterAll'),
                filterFavBtn: document.getElementById('filterFavorites'),
                categoryFilters: document.getElementById('categoryFilters'),
                noResults: document.getElementById('no-results'),
                modal: document.getElementById('recipeModal'),
                modalContent: document.getElementById('modalContent'),
                userInfo: document.getElementById('user-info'),
                themeToggle: document.getElementById('theme-toggle'),
                darkIcon: document.getElementById('theme-toggle-dark-icon'),
                lightIcon: document.getElementById('theme-toggle-light-icon'),
                copyrightYear: document.getElementById('copyright-year'),
                shoppingListFAB: document.getElementById('shoppingListFAB'),
                shoppingListModal: document.getElementById('shoppingListModal'),
                shoppingListContent: document.getElementById('shoppingListContent'),
                closeShoppingListBtn: document.getElementById('closeShoppingListBtn'),
                clearShoppingListBtn: document.getElementById('clearShoppingListBtn'),
                timersContainer: document.getElementById('timers-container'),
            };
            
            const allRecipes = [
                // 80 recetas
                { id: "patatas-bravas", name: "Patatas Bravas", category: "Aperitivo", time: "30 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1599921867822-6b3a0f0a5fee?q=80&w=800", ingredients: [{amount: 1, unit: 'kg', name: 'de patatas'}, {amount: null, unit: '', name: 'Aceite de oliva'}, {amount: null, unit: '', name: 'Salsa brava'}, {amount: null, unit: '', name: 'Alioli'}], steps: [{text: "Pela y corta las patatas en cubos irregulares."}, {text: "Fríelas en abundante aceite hasta que estén doradas y tiernas.", duration: 15}, {text: "Sírvelas calientes con salsa brava y alioli por encima."}] },
                { id: "gambas-al-ajillo", name: "Gambas al Ajillo", category: "Aperitivo", time: "10 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1639537339294-35e2193b134a?q=80&w=800", ingredients: [{amount: 250, unit: 'g', name: 'de gambas peladas'}, {amount: 4, unit: '', name: 'dientes de ajo'}, {amount: 1, unit: '', name: 'guindilla'}, {amount: null, unit: '', name: 'Aceite de oliva virgen extra'}, {amount: null, unit: '', name: 'Sal'}, {amount: null, unit: '', name: 'Perejil'}], steps: [{text: "Lamina los ajos y sofríelos con la guindilla en una cazuela de barro."}, {text: "Cuando los ajos empiecen a dorarse, añade las gambas y una pizca de sal."}, {text: "Saltea un par de minutos hasta que las gambas estén hechas.", duration: 2}, {text: "Espolvorea perejil picado y sirve inmediatamente."}] },
                { id: "gildas", name: "Gildas", category: "Aperitivo", time: "5 min", servings: 12, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Gildas", ingredients: [{amount: 12, unit: '', name: 'anchoas en salazón'}, {amount: 12, unit: '', name: 'aceitunas verdes sin hueso'}, {amount: 12, unit: '', name: 'guindillas en vinagre (piparras)'}], steps: [{text: "Ensarta en un palillo una aceituna, una guindilla doblada por la mitad y una anchoa."}] },
                { id: "mejillones-vinagreta", name: "Mejillones a la Vinagreta", category: "Aperitivo", time: "20 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1605494220434-a15d08a5d326?q=80&w=800", ingredients: [{amount: 1, unit: 'kg', name: 'de mejillones'}, {amount: 1, unit: '', name: 'cebolleta'}, {amount: 0.5, unit: '', name: 'pimiento verde'}, {amount: 0.5, unit: '', name: 'pimiento rojo'}, {amount: null, unit: '', name: 'Vinagre de vino blanco'}, {amount: null, unit: '', name: 'Aceite de oliva'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Abre los mejillones al vapor y quédate con la concha que tiene el mejillón."}, {text: "Pica las verduras muy finas y mézclalas en un bol."}, {text: "Aliña las verduras con aceite, vinagre y sal para hacer la vinagreta."}, {text: "Cubre cada mejillón con una cucharada de vinagreta."}] },
                { id: "champinones-al-ajillo", name: "Champiñones al Ajillo", category: "Aperitivo", time: "15 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1559160582-e9845523246f?q=80&w=800", ingredients: [{amount: 500, unit: 'g', name: 'de champiñones'}, {amount: 4, unit: '', name: 'dientes de ajo'}, {amount: 50, unit: 'g', name: 'de jamón serrano en tacos (opcional)'}, {amount: 50, unit: 'ml', name: 'de vino blanco'}, {amount: null, unit: '', name: 'Perejil picado'}, {amount: null, unit: '', name: 'Aceite de oliva'}], steps: [{text: "Limpia y lamina los champiñones."}, {text: "Dora los ajos laminados en una sartén. Añade el jamón si lo usas."}, {text: "Incorpora los champiñones y saltea a fuego fuerte.", duration: 5}, {text: "Añade un chorrito de vino blanco y deja que evapore."}, {text: "Espolvorea perejil y sirve."}] },
                { id: "boquerones-en-vinagre", name: "Boquerones en Vinagre", category: "Aperitivo", time: "15 min + marinado", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Boquerones", ingredients: [{amount: 500, unit: 'g', name: 'de boquerones frescos'}, {amount: 200, unit: 'ml', name: 'de vinagre de vino blanco'}, {amount: 3, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Perejil'}, {amount: 50, unit: 'ml', name: 'de aceite de oliva'}], steps: [{text: "Limpia los boquerones quitando cabeza, espina y tripas. Congélalos 48h para evitar anisakis."}, {text: "Descongela y sumérgelos en agua fría con sal."}, {text: "Cúbrelos con vinagre y déjalos marinar en la nevera hasta que estén blancos.", duration: 480}, {text: "Escúrrelos bien y alíñalos con ajo picado, perejil y aceite de oliva."}] },
                { id: "pimientos-de-padron", name: "Pimientos de Padrón", category: "Aperitivo", time: "10 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1628129334038-a281864f1d64?q=80&w=800", ingredients: [{amount: 300, unit: 'g', name: 'de pimientos de Padrón'}, {amount: null, unit: '', name: 'Aceite de oliva'}, {amount: null, unit: '', name: 'Sal gorda'}], steps: [{text: "Lava y seca bien los pimientos."}, {text: "Fríelos en una sartén con aceite caliente, removiendo hasta que la piel se arrugue.", duration: 5}, {text: "Sácalos, escúrrelos y sírvelos con abundante sal gorda por encima."}] },
                { id: "pan-con-tomate", name: "Pan con Tomate y Jamón", category: "Aperitivo", time: "5 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1588167040822-913045b74092?q=80&w=800", ingredients: [{amount: 4, unit: 'rebanadas', name: 'de pan de payés'}, {amount: 2, unit: '', name: 'tomates maduros de rama'}, {amount: 1, unit: '', name: 'diente de ajo (opcional)'}, {amount: null, unit: '', name: 'Aceite de oliva virgen extra'}, {amount: 100, unit: 'g', name: 'de jamón serrano'}], steps: [{text: "Tuesta las rebanadas de pan."}, {text: "Si te gusta, frota un diente de ajo en el pan tostado."}, {text: "Parte un tomate por la mitad y frótalo sobre el pan hasta que quede bien impregnado."}, {text: "Añade un chorro de aceite de oliva y coloca una loncha de jamón encima."}] },
                { id: "croquetas-de-jamon", name: "Croquetas de Jamón", category: "Aperitivo", time: "40 min + reposo", servings: 6, difficulty: "Medio", image: "https://images.unsplash.com/photo-1619861183287-353f2a8a1599?q=80&w=800", ingredients: [{amount: 100, unit: 'g', name: 'de jamón serrano'}, {amount: 1, unit: 'litro', name: 'de leche'}, {amount: 100, unit: 'g', name: 'de mantequilla'}, {amount: 100, unit: 'g', name: 'de harina'}, {amount: null, unit: '', name: 'Nuez moscada'}, {amount: null, unit: '', name: 'Sal'}, {amount: 2, unit: '', name: 'huevos para rebozar'}, {amount: null, unit: '', name: 'Pan rallado'}], steps: [{text: "Pica el jamón muy fino. Sofríelo un poco en la mantequilla."}, {text: "Añade la harina y tuéstala para hacer un roux."}, {text: "Vierte la leche poco a poco sin dejar de remover para hacer la bechamel.", duration: 15}, {text: "Añade sal y nuez moscada. Cocina hasta que espese."}, {text: "Deja enfriar la masa en la nevera (mínimo 4 horas).", duration: 240}, {text: "Forma las croquetas, pásalas por huevo y pan rallado, y fríelas en aceite caliente."}] },
                { id: "queso-manchego-membrillo", name: "Queso Manchego con Membrillo", category: "Aperitivo", time: "5 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Queso", ingredients: [{amount: 200, unit: 'g', name: 'de Queso Manchego curado'}, {amount: 150, unit: 'g', name: 'de dulce de membrillo'}], steps: [{text: "Corta el queso en cuñas o triángulos."}, {text: "Corta el membrillo en lonchas finas."}, {text: "Sirve una loncha de membrillo sobre cada trozo de queso."}] },
                { id: "zamburinas-plancha", name: "Zamburiñas a la Plancha", category: "Aperitivo", time: "10 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Zamburiñas", ingredients: [{amount: 12, unit: '', name: 'zamburiñas'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Perejil fresco'}, {amount: null, unit: '', name: 'Aceite de oliva virgen extra'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Limpia bien las zamburiñas."}, {text: "Pica finamente el ajo y el perejil y mézclalo con un buen chorro de aceite."}, {text: "Calienta una plancha o sartén a fuego fuerte."}, {text: "Cocina las zamburiñas 1-2 minutos por cada lado.", duration: 2}, {text: "Sírvelas inmediatamente con el aliño de ajo y perejil por encima."}] },
                { id: "tigres", name: "Tigres (Mejillones Rellenos)", category: "Aperitivo", time: "45 min", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Tigres", ingredients: [{amount: 1, unit: 'kg', name: 'de mejillones'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 50, unit: 'g', name: 'de mantequilla'}, {amount: 50, unit: 'g', name: 'de harina'}, {amount: 250, unit: 'ml', name: 'de leche'}, {amount: 2, unit: '', name: 'huevos y pan rallado para rebozar'}, {amount: null, unit: '', name: 'Pizca de cayena'}], steps: [{text: "Abre los mejillones al vapor, pica la carne y reserva las conchas."}, {text: "Pocha la cebolla en mantequilla. Añade la harina y luego la leche para hacer una bechamel.", duration: 10}, {text: "Añade el mejillón picado y la cayena. Rellena las conchas."}, {text: "Deja enfriar, pasa por huevo y pan rallado y fríe."}] },
                { id: "pimientos-rellenos-piquillo", name: "Pimientos del Piquillo Rellenos", category: "Aperitivo", time: "35 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Pimientos", ingredients: [{amount: 1, unit: 'lata', name: 'de pimientos del piquillo'}, {amount: 2, unit: 'latas', name: 'de atún'}, {amount: 0.5, unit: '', name: 'cebolla'}, {amount: 100, unit: 'ml', name: 'de salsa de tomate'}, {amount: 1, unit: '', name: 'huevo duro'}], steps: [{text: "Pocha la cebolla. Mezcla con el atún desmigado y el huevo duro picado."}, {text: "Añade un poco de salsa de tomate a la mezcla."}, {text: "Rellena los pimientos con cuidado."}, {text: "Sírvelos con más salsa de tomate por encima."}] },
                { id: "ensalada-campera", name: "Ensalada Campera", category: "Aperitivo", time: "30 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Ensalada+Campera", ingredients: [{amount: 4, unit: '', name: 'patatas cocidas'}, {amount: 2, unit: '', name: 'huevos duros'}, {amount: 1, unit: 'lata', name: 'de atún'}, {amount: 1, unit: '', name: 'cebolleta'}, {amount: 1, unit: '', name: 'pimiento verde'}, {amount: 1, unit: '', name: 'tomate'}, {amount: null, unit: '', name: 'Aceitunas'}], steps: [{text: "Corta las patatas y huevos en trozos."}, {text: "Pica la cebolleta, pimiento y tomate."}, {text: "Mezcla todos los ingredientes en un bol con el atún y las aceitunas."}, {text: "Aliña con aceite de oliva, vinagre y sal."}] },
                { id: "pulpo-a-la-gallega", name: "Pulpo a la Gallega", category: "Aperitivo", time: "20 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1672322437950-e8837775973a?q=80&w=800", ingredients: [{amount: 1, unit: '', name: 'pulpo cocido'}, {amount: 2, unit: '', name: 'patatas cocidas'}, {amount: null, unit: '', name: 'Pimentón dulce y picante'}, {amount: null, unit: '', name: 'Sal gorda'}, {amount: null, unit: '', name: 'Aceite de oliva'}], steps: [{text: "Corta el pulpo en rodajas con tijeras."}, {text: "Corta las patatas en rodajas y colócalas como base."}, {text: "Pon el pulpo sobre las patatas."}, {text: "Aliña con sal gorda, los dos pimentones y un buen chorro de aceite."}] },
                { id: "chorizo-a-la-sidra", name: "Chorizo a la Sidra", category: "Aperitivo", time: "25 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Chorizo+a+la+Sidra", ingredients: [{amount: 4, unit: '', name: 'chorizos frescos'}, {amount: 1, unit: 'botella', name: 'de sidra natural'}, {amount: 1, unit: '', name: 'hoja de laurel'}], steps: [{text: "Pincha los chorizos con un tenedor."}, {text: "Ponlos en una cazuela con el laurel y cúbrelos con sidra."}, {text: "Cuece a fuego medio hasta que la sidra reduzca.", duration: 20}, {text: "Sirve el chorizo cortado en rodajas con la salsa."}] },
                { id: "morcilla-de-burgos", name: "Morcilla de Burgos Frita", category: "Aperitivo", time: "15 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Morcilla", ingredients: [{amount: 1, unit: '', name: 'morcilla de Burgos'}, {amount: null, unit: '', name: 'Pimientos del piquillo (opcional)'}, {amount: null, unit: '', name: 'Aceite de oliva'}], steps: [{text: "Corta la morcilla en rodajas de 1-2 cm de grosor."}, {text: "Pásalas ligeramente por harina (opcional)."}, {text: "Fríelas en una sartén con poco aceite, vuelta y vuelta, hasta que estén crujientes."}, {text: "Sirve caliente, acompañada de pimientos del piquillo."}] },
                { id: "setas-al-ajillo", name: "Setas al Ajillo", category: "Aperitivo", time: "15 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Setas+al+Ajillo", ingredients: [{amount: 400, unit: 'g', name: 'de setas de temporada'}, {amount: 3, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Perejil'}, {amount: null, unit: '', name: 'Guindilla (opcional)'}, {amount: 50, unit: 'ml', name: 'de vino blanco'}], steps: [{text: "Limpia y trocea las setas."}, {text: "Dora los ajos laminados y la guindilla en una sartén."}, {text: "Añade las setas y saltea a fuego fuerte.", duration: 7}, {text: "Cuando suelten el agua, añade un chorro de vino y deja que reduzca."}, {text: "Espolvorea con perejil picado."}] },
                { id: "empanadillas-de-atun", name: "Empanadillas de Atún", category: "Aperitivo", time: "30 min", servings: 16, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Empanadillas", ingredients: [{amount: 1, unit: 'paquete', name: 'de obleas para empanadillas'}, {amount: 2, unit: 'latas', name: 'de atún'}, {amount: 0.5, unit: '', name: 'cebolla pochada'}, {amount: 1, unit: '', name: 'huevo duro picado'}, {amount: 3, unit: 'cucharadas', name: 'de salsa de tomate'}, {amount: 1, unit: '', name: 'huevo para pintar'}], steps: [{text: "Mezcla el atún escurrido con la cebolla, el huevo duro y salsa de tomate."}, {text: "Rellena cada oblea con una cucharada de la mezcla."}, {text: "Cierra las empanadillas sellando los bordes con un tenedor."}, {text: "Píntalas con huevo batido y hornea a 180°C hasta que estén doradas, o fríelas.", duration: 15}] },
                { id: "montadito-de-pringa", name: "Montadito de Pringá", category: "Aperitivo", time: "10 min", servings: 6, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Pringá", ingredients: [{amount: 200, unit: 'g', name: 'de pringá del cocido (chorizo, morcilla, carne)'}, {amount: 6, unit: '', name: 'panecillos pequeños'}], steps: [{text: "Desmenuza y mezcla todos los ingredientes de la pringá."}, {text: "Calienta la mezcla en una sartén."}, {text: "Tuesta los panecillos abiertos."}, {text: "Rellena los panecillos generosamente con la pringá caliente."}] },
                // 20 Primeros
                { id: "gazpacho-andaluz", name: "Gazpacho Andaluz", category: "Primero", time: "15 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1625944228743-9281a173a113?q=80&w=800", ingredients: [{amount: 1, unit: 'kg', name: 'de tomates maduros'}, {amount: 1, unit: '', name: 'pimiento verde'}, {amount: 1, unit: '', name: 'pepino'}, {amount: 1, unit: '', name: 'diente de ajo'}, {amount: 50, unit: 'g', name: 'de pan'}, {amount: 100, unit: 'ml', name: 'de aceite de oliva virgen extra'}, {amount: 30, unit: 'ml', name: 'de vinagre de Jerez'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Lava y trocea las verduras."}, {text: "Pon todo en la batidora con el pan, aceite, vinagre y sal."}, {text: "Bate hasta que quede una crema fina."}, {text: "Enfría en la nevera antes de servir."}] },
                { id: "lentejas-estofadas", name: "Lentejas Estofadas", category: "Primero", time: "50 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1625944132003-24153a812b1b?q=80&w=800", ingredients: [{amount: 400, unit: 'g', name: 'de lentejas pardinas'}, {amount: 1, unit: '', name: 'chorizo'}, {amount: 1, unit: '', name: 'patata'}, {amount: 1, unit: '', name: 'zanahoria'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 1, unit: '', name: 'hoja de laurel'}, {amount: 1, unit: 'cucharadita', name: 'de pimentón dulce'}], steps: [{text: "Sofríe la cebolla y zanahoria picadas."}, {text: "Añade el chorizo y la patata en trozos. Rehoga."}, {text: "Incorpora las lentejas, el laurel y el pimentón."}, {text: "Cubre con agua, añade sal y cuece a fuego lento 40-50 minutos.", duration: 45}] },
                { id: "sopa-de-ajo", name: "Sopa de Ajo (Castellana)", category: "Primero", time: "25 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Sopa+de+Ajo", ingredients: [{amount: 200, unit: 'g', name: 'de pan duro'}, {amount: 6, unit: '', name: 'dientes de ajo'}, {amount: 100, unit: 'g', name: 'de jamón serrano'}, {amount: 1, unit: 'cucharada', name: 'de pimentón dulce'}, {amount: 1, unit: 'litro', name: 'de caldo de pollo'}, {amount: 2, unit: '', name: 'huevos'}, {amount: null, unit: '', name: 'Aceite'}], steps: [{text: "Corta el pan en rebanadas finas."}, {text: "Dora los ajos laminados y el jamón."}, {text: "Retira del fuego, añade el pimentón. Remueve."}, {text: "Añade el pan y el caldo. Cuece 15 min.", duration: 15}, {text: "Justo antes de servir, casca los huevos en la sopa y remueve para que se cuajen."}] },
                { id: "ensaladilla-rusa", name: "Ensaladilla Rusa", category: "Primero", time: "40 min + reposo", servings: 6, difficulty: "Medio", image: "https://images.unsplash.com/photo-1604329227594-3d9697ac7249?q=80&w=800", ingredients: [{amount: 500, unit: 'g', name: 'de patatas'}, {amount: 2, unit: '', name: 'zanahorias'}, {amount: 2, unit: '', name: 'huevos'}, {amount: 1, unit: 'lata', name: 'de atún'}, {amount: 100, unit: 'g', name: 'de guisantes'}, {amount: null, unit: '', name: 'Aceitunas'}, {amount: 200, unit: 'g', name: 'de mayonesa'}], steps: [{text: "Cuece las patatas, zanahorias y huevos.", duration: 20}, {text: "Pela y pica todo en dados pequeños."}, {text: "Mezcla la patata, zanahoria, huevo, atún, guisantes y aceitunas."}, {text: "Añade mayonesa y mezcla con cuidado."}, {text: "Deja enfriar en la nevera al menos 2 horas.", duration: 120}] },
                { id: "salmorejo-cordobes", name: "Salmorejo Cordobés", category: "Primero", time: "15 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1598514982249-916212e62444?q=80&w=800", ingredients: [{amount: 1, unit: 'kg', name: 'de tomates pera'}, {amount: 200, unit: 'g', name: 'de pan de telera'}, {amount: 1, unit: '', name: 'diente de ajo'}, {amount: 100, unit: 'ml', name: 'de aceite de oliva'}, {amount: null, unit: '', name: 'Sal'}, {amount: 50, unit: 'g', name: 'de jamón serrano'}, {amount: 1, unit: '', name: 'huevo duro'}], steps: [{text: "Tritura los tomates y cuélalos."}, {text: "Añade el pan, el ajo y la sal. Tritura."}, {text: "Emulsiona añadiendo el aceite en un hilo fino."}, {text: "Sirve frío con jamón y huevo duro picado."}] },
                { id: "fabada-asturiana", name: "Fabada Asturiana", category: "Primero", time: "3 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Fabada", ingredients: [{amount: 500, unit: 'g', name: 'de fabes'}, {amount: 2, unit: '', name: 'morcillas asturianas'}, {amount: 2, unit: '', name: 'chorizos asturianos'}, {amount: 200, unit: 'g', name: 'de panceta'}, {amount: null, unit: '', name: 'Azafrán'}], steps: [{text: "Deja las fabes en remojo la noche anterior."}, {text: "Pon las fabes y el compango en una olla, cubre con agua fría y lleva a ebullición."}, {text: "Desespuma y baja el fuego. Cuece lentamente 2-3 horas.", duration: 150}, {text: "'Asusta' las fabes con agua fría un par de veces."}, {text: "Añade el azafrán al final y deja reposar."}] },
                { id: "pisto-manchego", name: "Pisto Manchego", category: "Primero", time: "45 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1571991285272-46a2a078e515?q=80&w=800", ingredients: [{amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'pimientos verdes'}, {amount: 1, unit: '', name: 'pimiento rojo'}, {amount: 1, unit: '', name: 'calabacín'}, {amount: 800, unit: 'g', name: 'de tomate triturado'}, {amount: null, unit: '', name: 'Aceite'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Pica todas las verduras en dados."}, {text: "Pocha la cebolla y los pimientos."}, {text: "Añade el calabacín y cocina 15 minutos.", duration: 15}, {text: "Vierte el tomate y cocina a fuego lento 25 minutos.", duration: 25}] },
                { id: "marmitako", name: "Marmitako", category: "Primero", time: "60 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Marmitako", ingredients: [{amount: 500, unit: 'g', name: 'de bonito del norte'}, {amount: 4, unit: '', name: 'patatas'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'pimientos choriceros'}, {amount: 1, unit: '', name: 'pimiento verde'}, {amount: 1, unit: 'litro', name: 'de caldo de pescado'}], steps: [{text: "Hidrata los pimientos choriceros y saca la pulpa."}, {text: "Sofríe la cebolla y pimiento verde."}, {text: "Añade las patatas cascadas y la pulpa del choricero. Rehoga."}, {text: "Cubre con caldo y cuece hasta que la patata esté tierna.", duration: 25}, {text: "Añade el bonito en dados y cuece 2 minutos. Deja reposar.", duration: 2}] },
                { id: "crema-de-calabacin", name: "Crema de Calabacín", category: "Primero", time: "30 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1505586549231-c352c5f21533?q=80&w=800", ingredients: [{amount: 2, unit: '', name: 'calabacines'}, {amount: 1, unit: '', name: 'patata'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 100, unit: 'ml', name: 'de nata líquida (opcional)'}, {amount: 750, unit: 'ml', name: 'de caldo de verduras'}, {amount: 4, unit: '', name: 'quesitos'}], steps: [{text: "Pocha la cebolla en una olla."}, {text: "Añade el calabacín y la patata en trozos. Rehoga."}, {text: "Cubre con caldo y cuece 20 minutos.", duration: 20}, {text: "Tritura todo con la batidora. Añade los quesitos y un chorrito de nata para más cremosidad."}, {text: "Sirve caliente."}] },
                { id: "arroz-caldoso-con-bogavante", name: "Arroz con Bogavante", category: "Primero", time: "50 min", servings: 2, difficulty: "Difícil", image: "https://images.unsplash.com/photo-1598514983318-7293e6875953?q=80&w=800", ingredients: [{amount: 1, unit: '', name: 'bogavante'}, {amount: 200, unit: 'g', name: 'de arroz bomba'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: 100, unit: 'g', name: 'de tomate triturado'}, {amount: 1, unit: 'litro', name: 'de fumet de pescado'}], steps: [{text: "Sofríe el bogavante troceado y reserva."}, {text: "En el mismo aceite, haz un sofrito con la cebolla, ajo y tomate."}, {text: "Añade el arroz y nacara."}, {text: "Vierte el fumet caliente y cuece 15 minutos.", duration: 15}, {text: "Incorpora los trozos de bogavante y cuece 3 minutos más.", duration: 3}] },
                { id: "porrusalda", name: "Porrusalda", category: "Primero", time: "35 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Porrusalda", ingredients: [{amount: 4, unit: '', name: 'puerros grandes'}, {amount: 2, unit: '', name: 'patatas'}, {amount: 1, unit: '', name: 'zanahoria'}, {amount: 1, unit: 'litro', name: 'de caldo de verduras o agua'}, {amount: null, unit: '', name: 'Aceite de oliva virgen extra'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Limpia los puerros y córtalos en rodajas (solo la parte blanca y verde clara)."}, {text: "Pela y chasca las patatas y la zanahoria."}, {text: "En una olla, pocha el puerro con aceite de oliva."}, {text: "Añade la patata y la zanahoria y rehoga unos minutos."}, {text: "Cubre con caldo, sazona y cuece a fuego medio hasta que las verduras estén tiernas.", duration: 20}] },
                { id: "sopa-de-marisco", name: "Sopa de Marisco", category: "Primero", time: "50 min", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Sopa+Marisco", ingredients: [{amount: 250, unit: 'g', name: 'de cabezas de gambas y langostinos'}, {amount: 500, unit: 'g', name: 'de pescado de roca'}, {amount: 1, unit: '', name: 'puerro'}, {amount: 1, unit: '', name: 'zanahoria'}, {amount: 1, unit: '', name: 'tomate'}, {amount: 50, unit: 'ml', name: 'de brandy'}, {amount: 50, unit: 'g', name: 'de arroz (opcional)'}], steps: [{text: "Tuesta las cabezas de marisco en una olla. Flambea con brandy."}, {text: "Añade las verduras y el pescado de roca. Cubre con agua y cuece 30 min.", duration: 30}, {text: "Cuela el caldo apretando bien."}, {text: "Cuece un poco de arroz o fideos en el caldo antes de servir."}] },
                { id: "alubias-de-tolosa", name: "Alubias de Tolosa", category: "Primero", time: "2 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Alubias+Tolosa", ingredients: [{amount: 500, unit: 'g', name: 'de alubias de Tolosa'}, {amount: 1, unit: '', name: 'berza'}, {amount: 1, unit: '', name: 'morcilla'}, {amount: 1, unit: '', name: 'chorizo'}, {amount: 150, unit: 'g', name: 'de panceta'}, {amount: null, unit: '', name: 'Guindillas de Ibarra'}], steps: [{text: "Pon a cocer las alubias en agua fría."}, {text: "Cuando hiervan, añade el chorizo y la panceta."}, {text: "Cuece a fuego lento durante 2 horas. Añade la morcilla a mitad de cocción.", duration: 120}, {text: "Aparte, cuece la berza. Sirve las alubias con su compango, la berza y guindillas."}] },
                { id: "migas-extremenas", name: "Migas Extremeñas", category: "Primero", time: "30 min + reposo", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Migas", ingredients: [{amount: 1, unit: 'kg', name: 'de pan duro'}, {amount: 200, unit: 'g', name: 'de panceta'}, {amount: 1, unit: '', name: 'chorizo'}, {amount: 2, unit: '', name: 'pimientos'}, {amount: 1, unit: 'cabeza', name: 'de ajos'}, {amount: null, unit: '', name: 'Agua'}, {amount: null, unit: '', name: 'Sal'}, {amount: 1, unit: 'cucharada', name: 'de pimentón de la Vera'}], steps: [{text: "El día anterior, corta el pan en dados y humedécelo ligeramente con agua y sal."}, {text: "Fríe los pimientos y reserva. En el mismo aceite, fríe la panceta y el chorizo. Reserva."}, {text: "Dora los ajos y añade el pimentón."}, {text: "Incorpora el pan y remueve constantemente con una rasera a fuego medio hasta que las migas estén sueltas y doradas.", duration: 20}, {text: "Sirve con las carnes y los pimientos."}] },
                { id: "espinacas-a-la-catalana", name: "Espinacas a la Catalana", category: "Primero", time: "20 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Espinacas", ingredients: [{amount: 500, unit: 'g', name: 'de espinacas frescas'}, {amount: 40, unit: 'g', name: 'de pasas'}, {amount: 40, unit: 'g', name: 'de piñones'}, {amount: 2, unit: '', name: 'dientes de ajo'}], steps: [{text: "Pon las pasas en remojo."}, {text: "Tuesta los piñones en una sartén y reserva."}, {text: "Saltea los ajos laminados."}, {text: "Añade las espinacas y cocina hasta que reduzcan.", duration: 5}, {text: "Incorpora las pasas escurridas y los piñones. Saltea todo junto."}] },
                { id: "arroz-negro", name: "Arroz Negro", category: "Primero", time: "40 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Arroz+Negro", ingredients: [{amount: 300, unit: 'g', name: 'de arroz bomba'}, {amount: 2, unit: '', name: 'calamares'}, {amount: 4, unit: '', name: 'tintas de calamar'}, {amount: 0.5, unit: '', name: 'cebolla'}, {amount: 1, unit: '', name: 'diente de ajo'}, {amount: 1, unit: 'litro', name: 'de fumet de pescado'}, {amount: null, unit: '', name: 'Alioli'}], steps: [{text: "Sofríe la cebolla y el ajo. Añade el calamar en trozos y cocina."}, {text: "Disuelve la tinta en un poco de fumet."}, {text: "Añade el arroz y rehoga. Incorpora la tinta y el resto del fumet caliente."}, {text: "Cuece durante 18 minutos.", duration: 18}, {text: "Sirve con alioli."}] },
                { id: "potaje-garbanzos", name: "Potaje de Garbanzos con Bacalao", category: "Primero", time: "1.5 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Potaje", ingredients: [{amount: 400, unit: 'g', name: 'de garbanzos'}, {amount: 300, unit: 'g', name: 'de bacalao desalado'}, {amount: 1, unit: 'manojo', name: 'de espinacas'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'huevos duros'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: 1, unit: 'cucharadita', name: 'de pimentón'}], steps: [{text: "Deja los garbanzos en remojo la noche anterior."}, {text: "Cuece los garbanzos en una olla con agua.", duration: 60}, {text: "Haz un sofrito con cebolla, ajo y pimentón y añádelo a la olla."}, {text: "Cuando los garbanzos estén tiernos, añade las espinacas y el bacalao desmigado."}, {text: "Cuece 5 minutos más y sirve con huevo duro picado.", duration: 5}] },
                { id: "crema-champinones", name: "Crema de Champiñones", category: "Primero", time: "30 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Crema+Champiñones", ingredients: [{amount: 500, unit: 'g', name: 'de champiñones'}, {amount: 1, unit: '', name: 'puerro'}, {amount: 1, unit: '', name: 'patata'}, {amount: 800, unit: 'ml', name: 'de caldo de pollo'}, {amount: 100, unit: 'ml', name: 'de nata líquida'}], steps: [{text: "Limpia y trocea los champiñones y el puerro."}, {text: "Sofríe el puerro en una olla, luego añade los champiñones y la patata."}, {text: "Cubre con caldo y cuece 20 minutos.", duration: 20}, {text: "Tritura bien. Añade un chorro de nata y mezcla."}, {text: "Sirve caliente con picatostes."}] },
                { id: "patatas-a-la-riojana", name: "Patatas a la Riojana", category: "Primero", time: "40 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Patatas+Riojana", ingredients: [{amount: 4, unit: '', name: 'patatas'}, {amount: 2, unit: '', name: 'chorizos riojanos'}, {amount: 1, unit: '', name: 'pimiento choricero'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Sal'}, {amount: 1, unit: '', name: 'hoja de laurel'}], steps: [{text: "Hidrata el pimiento choricero y saca la pulpa."}, {text: "Sofríe la cebolla y los ajos picados."}, {text: "Añade el chorizo en rodajas y rehoga."}, {text: "Incorpora las patatas cascadas y la pulpa del pimiento. Cubre con agua."}, {text: "Añade sal y laurel, y cuece hasta que la patata esté tierna.", duration: 25}] },
                { id: "sopa-pescado", name: "Sopa de Pescado", category: "Primero", time: "45 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Sopa+Pescado", ingredients: [{amount: 250, unit: 'g', name: 'de merluza'}, {amount: 100, unit: 'g', name: 'de gambas'}, {amount: 1, unit: '', name: 'puerro'}, {amount: 1, unit: '', name: 'zanahoria'}, {amount: 1, unit: '', name: 'tomate'}, {amount: null, unit: '', name: 'Pan frito'}, {amount: 1, unit: 'litro', name: 'de fumet de pescado'}], steps: [{text: "Pocha el puerro y la zanahoria."}, {text: "Añade el tomate rallado y cocina."}, {text: "Vierte el fumet de pescado y cuece 15 minutos. Tritura.", duration: 15}, {text: "Añade el pescado desmenuzado y las gambas peladas. Cuece 5 minutos.", duration: 5}, {text: "Sirve con pan frito."}] },
                // 20 Segundos
                { id: "paella-valenciana", name: "Paella Valenciana", category: "Segundo", time: "60 min", servings: 4, difficulty: "Difícil", image: "https://images.unsplash.com/photo-1579871494474-a4b56a7d1ae9?q=80&w=800", ingredients: [{amount: 300, unit: 'g', name: 'de arroz bomba'}, {amount: 400, unit: 'g', name: 'de pollo'}, {amount: 300, unit: 'g', name: 'de conejo'}, {amount: 150, unit: 'g', name: 'de judía verde'}, {amount: 100, unit: 'g', name: 'de garrofón'}, {amount: null, unit: '', name: 'Azafrán'}], steps: [{text: "Sofríe las carnes."}, {text: "Añade las verduras y el tomate."}, {text: "Incorpora el agua y, cuando hierva, el azafrán y el arroz."}, {text: "Cocina hasta que el arroz esté en su punto.", duration: 18}] },
                { id: "rabo-de-toro", name: "Rabo de Toro Estofado", category: "Segundo", time: "4 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Rabo+de+Toro", ingredients: [{amount: 1.5, unit: 'kg', name: 'de rabo de toro'}, {amount: 2, unit: '', name: 'cebollas'}, {amount: 2, unit: '', name: 'zanahorias'}, {amount: 1, unit: '', name: 'puerro'}, {amount: 500, unit: 'ml', name: 'de vino tinto'}, {amount: 500, unit: 'ml', name: 'de caldo de carne'}], steps: [{text: "Salpimenta y enharina el rabo. Dóralo en una olla rápida."}, {text: "Sofríe las verduras picadas en el mismo aceite."}, {text: "Incorpora el rabo, el vino y el caldo."}, {text: "Cierra la olla y cuece durante 2 horas desde que suba la válvula.", duration: 120}, {text: "Deja reposar y sirve con puré de patatas."}] },
                { id: "merluza-salsa-verde", name: "Merluza en Salsa Verde", category: "Segundo", time: "25 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1628203102432-159c3a35f795?q=80&w=800", ingredients: [{amount: 4, unit: 'lomos', name: 'de merluza'}, {amount: 200, unit: 'g', name: 'de almejas'}, {amount: 100, unit: 'g', name: 'de guisantes'}, {amount: 3, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Perejil'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 200, unit: 'ml', name: 'de fumet de pescado'}], steps: [{text: "Dora los ajos en una cazuela."}, {text: "Coloca los lomos de merluza con la piel hacia arriba."}, {text: "Añade el vino, las almejas, los guisantes y el perejil picado."}, {text: "Vierte el fumet y cocina 10-15 minutos moviendo la cazuela en vaivén para ligar la salsa.", duration: 12}] },
                { id: "pollo-al-ajillo", name: "Pollo al Ajillo", category: "Segundo", time: "40 min", servings: 4, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1606013022559-12f865ae487c?q=80&w=800", ingredients: [{amount: 1, unit: '', name: 'pollo troceado'}, {amount: 1, unit: 'cabeza', name: 'de ajos'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 1, unit: '', name: 'hoja de laurel'}, {amount: null, unit: '', name: 'Aceite de oliva'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Salpimenta el pollo y dóralo en una sartén."}, {text: "Añade los dientes de ajo sin pelar (con un corte) y el laurel."}, {text: "Vierte el vino blanco y deja que evapore el alcohol."}, {text: "Baja el fuego, tapa y cocina 20-25 minutos hasta que el pollo esté tierno.", duration: 22}] },
                { id: "cochinillo-asado", name: "Cochinillo Asado", category: "Segundo", time: "3 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Cochinillo", ingredients: [{amount: 1, unit: '', name: 'cochinillo de 4-5kg'}, {amount: 100, unit: 'g', name: 'de manteca de cerdo'}, {amount: 200, unit: 'ml', name: 'de agua'}, {amount: null, unit: '', name: 'Sal'}], steps: [{text: "Coloca el cochinillo en una fuente de barro con la piel hacia abajo."}, {text: "Añade un dedo de agua en la fuente."}, {text: "Ásalo en el horno precalentado a 160°C durante 1.5 horas.", duration: 90}, {text: "Dale la vuelta, pínchale la piel, úntalo con manteca y sube el horno a 190°C."}, {text: "Asa 1 hora más hasta que la piel esté dorada y crujiente.", duration: 60}] },
                { id: "bacalao-al-pil-pil", name: "Bacalao al Pil-Pil", category: "Segundo", time: "45 min", servings: 4, difficulty: "Difícil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Bacalao", ingredients: [{amount: 4, unit: 'lomos', name: 'de bacalao desalado'}, {amount: 6, unit: '', name: 'dientes de ajo'}, {amount: 2, unit: '', name: 'guindillas'}, {amount: 200, unit: 'ml', name: 'de aceite de oliva virgen extra'}], steps: [{text: "Confita los lomos de bacalao en aceite con ajos y guindillas a fuego muy bajo.", duration: 15}, {text: "Retira el bacalao y deja templar el aceite."}, {text: "Vierte el aceite en un colador fino sobre un bol, moviendo en círculos para que la gelatina del pescado emulsione con el aceite y forme la salsa pil-pil."}] },
                { id: "fideua", name: "Fideuà", category: "Segundo", time: "40 min", servings: 4, difficulty: "Medio", image: "https://images.unsplash.com/photo-1598514983318-7293e6875953?q=80&w=800", ingredients: [{amount: 300, unit: 'g', name: 'de fideos para fideuà'}, {amount: 200, unit: 'g', name: 'de gambas'}, {amount: 200, unit: 'g', name: 'de calamares'}, {amount: 250, unit: 'g', name: 'de mejillones'}, {amount: 1, unit: 'litro', name: 'de fumet de pescado'}], steps: [{text: "Sofríe el marisco y reserva."}, {text: "En el mismo aceite, sofríe los fideos hasta que estén dorados."}, {text: "Añade un sofrito de tomate y pimiento."}, {text: "Incorpora el fumet caliente y cuece según el tiempo del fabricante.", duration: 12}, {text: "Añade el marisco y termina la cocción."}] },
                { id: "albondigas-en-salsa", name: "Albóndigas en Salsa Española", category: "Segundo", time: "50 min", servings: 4, difficulty: "Medio", image: "https://images.unsplash.com/photo-1598514982249-916212e62444?q=80&w=800", ingredients: [{amount: 500, unit: 'g', name: 'de carne picada'}, {amount: 1, unit: '', name: 'huevo'}, {amount: 50, unit: 'g', name: 'de pan rallado'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Perejil'}, {amount: null, unit: '', name: 'Harina'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 1, unit: '', name: 'zanahoria'}, {amount: 100, unit: 'ml', name: 'de vino tinto'}, {amount: 400, unit: 'ml', name: 'de caldo'}], steps: [{text: "Mezcla la carne con huevo, pan, ajo y perejil. Forma las albóndigas."}, {text: "Pásalas por harina y fríelas. Reserva."}, {text: "En el mismo aceite, pocha las verduras para la salsa."}, {text: "Añade el vino y el caldo. Tritura la salsa."}, {text: "Incorpora las albóndigas y cuece 20 minutos.", duration: 20}] },
                { id: "cordero-asado", name: "Cordero Asado", category: "Segundo", time: "2 horas", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Cordero", ingredients: [{amount: 1, unit: '', name: 'paletilla de cordero lechal'}, {amount: 100, unit: 'ml', name: 'de agua'}, {amount: null, unit: '', name: 'Sal'}, {amount: 50, unit: 'g', name: 'de manteca de cerdo'}], steps: [{text: "Precalienta el horno a 180°C."}, {text: "Coloca la paletilla con la piel hacia abajo en una fuente."}, {text: "Añade un poco de agua y sal. Asa durante 1 hora.", duration: 60}, {text: "Dale la vuelta, unta con manteca y asa 45 minutos más hasta que esté dorada.", duration: 45}] },
                { id: "calamares-en-su-tinta", name: "Calamares en su Tinta", category: "Segundo", time: "60 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Calamares", ingredients: [{amount: 1, unit: 'kg', name: 'de calamares'}, {amount: 2, unit: '', name: 'cebollas'}, {amount: 2, unit: 'bolsitas', name: 'de tinta de calamar'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 200, unit: 'ml', name: 'de fumet de pescado'}], steps: [{text: "Limpia los calamares, reserva las tintas y los tentáculos."}, {text: "Pica los tentáculos y sofríelos con cebolla para el relleno."}, {text: "Rellena los calamares y ciérralos con un palillo."}, {text: "Sofríe los calamares rellenos. En la misma cazuela, pocha la otra cebolla, añade el vino y la tinta diluida."}, {text: "Cubre con fumet y cuece a fuego lento 40 minutos.", duration: 40}] },
                { id: "zarzuela-pescado", name: "Zarzuela de Pescado", category: "Segundo", time: "50 min", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Zarzuela", ingredients: [{amount: 400, unit: 'g', name: 'de rape'}, {amount: 250, unit: 'g', name: 'de calamares'}, {amount: 8, unit: '', name: 'langostinos'}, {amount: 8, unit: '', name: 'mejillones'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: 200, unit: 'g', name: 'de tomate triturado'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 500, unit: 'ml', name: 'de fumet de pescado'}, {amount: 20, unit: 'g', name: 'de almendras tostadas para picada'}], steps: [{text: "Sofríe los langostinos y el rape y reserva."}, {text: "En el mismo aceite, pocha la cebolla y el ajo."}, {text: "Añade los calamares y el tomate. Cocina 10 minutos.", duration: 10}, {text: "Vierte el vino blanco y deja reducir. Añade el fumet."}, {text: "Incorpora el pescado, los langostinos y los mejillones (abiertos al vapor)."}, {text: "Añade una picada de ajo, perejil y almendras y cuece todo junto 5 minutos.", duration: 5}] },
                { id: "cachopo-asturiano", name: "Cachopo Asturiano", category: "Segundo", time: "30 min", servings: 2, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Cachopo", ingredients: [{amount: 2, unit: 'filetes grandes', name: 'de ternera'}, {amount: 4, unit: 'lonchas', name: 'de jamón serrano'}, {amount: 4, unit: 'lonchas', name: 'de queso'}, {amount: 2, unit: '', name: 'huevos'}, {amount: null, unit: '', name: 'Pan rallado'}, {amount: null, unit: '', name: 'Aceite para freír'}], steps: [{text: "Extiende un filete, cubre con jamón y queso, y tapa con el otro filete."}, {text: "Presiona bien los bordes."}, {text: "Pasa el cachopo por huevo batido y luego por pan rallado."}, {text: "Fríelo en abundante aceite caliente hasta que esté dorado por ambos lados."}] },
                { id: "trucha-a-la-navarra", name: "Trucha a la Navarra", category: "Segundo", time: "20 min", servings: 2, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Trucha+Navarra", ingredients: [{amount: 2, unit: '', name: 'truchas limpias'}, {amount: 4, unit: 'lonchas', name: 'de jamón serrano'}, {amount: 2, unit: '', name: 'dientes de ajo'}, {amount: null, unit: '', name: 'Aceite de oliva'}, {amount: null, unit: '', name: 'Harina'}], steps: [{text: "Sazona las truchas por dentro y por fuera."}, {text: "Introduce dos lonchas de jamón en cada trucha."}, {text: "Pasa las truchas por harina y fríelas en una sartén con aceite."}, {text: "En el mismo aceite, dora unos ajos laminados y viértelos sobre las truchas al servir."}] },
                { id: "pollo-en-pepitoria", name: "Pollo en Pepitoria", category: "Segundo", time: "60 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Pollo+Pepitoria", ingredients: [{amount: 1, unit: '', name: 'pollo troceado'}, {amount: 2, unit: '', name: 'huevos duros'}, {amount: null, unit: '', name: 'Azafrán'}, {amount: 30, unit: 'g', name: 'de almendras tostadas'}, {amount: 500, unit: 'ml', name: 'de caldo de pollo'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'dientes de ajo'}], steps: [{text: "Dora el pollo enharinado y reserva."}, {text: "Sofríe la cebolla y el ajo. Añade el pollo."}, {text: "Maja las yemas de los huevos duros con el azafrán y las almendras. Deslíe con un poco de caldo."}, {text: "Vierte la mezcla sobre el pollo y añade más caldo. Cuece 40 minutos.", duration: 40}, {text: "Sirve con las claras de huevo picadas."}] },
                { id: "callos-a-la-madrilena", name: "Callos a la Madrileña", category: "Segundo", time: "3 horas", servings: 6, difficulty: "Difícil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Callos", ingredients: [{amount: 1, unit: 'kg', name: 'de callos de ternera'}, {amount: 250, unit: 'g', name: 'de morro y pata de ternera'}, {amount: 1, unit: '', name: 'chorizo'}, {amount: 1, unit: '', name: 'morcilla'}, {amount: 100, unit: 'g', name: 'de jamón serrano'}, {amount: 1, unit: 'cucharada', name: 'de pimentón'}, {amount: 1, unit: '', name: 'guindilla'}], steps: [{text: "Limpia y cuece los callos, el morro y la pata en olla rápida durante 1 hora.", duration: 60}, {text: "Sofríe cebolla y ajo, añade jamón, chorizo, pimentón y guindilla."}, {text: "Incorpora los callos y su caldo de cocción."}, {text: "Añade la morcilla y cuece todo a fuego lento durante 2 horas.", duration: 120}] },
                { id: "chipirones-en-su-tinta", name: "Chipirones en su Tinta", category: "Segundo", time: "50 min", servings: 4, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Chipirones", ingredients: [{amount: 1, unit: 'kg', name: 'de chipirones'}, {amount: 2, unit: '', name: 'cebollas'}, {amount: 2, unit: 'bolsitas', name: 'de tinta de chipirón'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: null, unit: '', name: 'Arroz blanco para acompañar'}], steps: [{text: "Limpia los chipirones, guardando las tintas. Rellena los cuerpos con las patas."}, {text: "Sofríe la cebolla muy picada. Añade los chipirones y el vino."}, {text: "Diluye la tinta en agua y añádela. Cuece a fuego lento 30-40 minutos.", duration: 35}, {text: "Sirve con arroz blanco."}] },
                { id: "ternera-jardinera", name: "Ternera a la Jardinera", category: "Segundo", time: "1.5 horas", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Ternera+Jardinera", ingredients: [{amount: 800, unit: 'g', name: 'de ternera para guisar'}, {amount: 150, unit: 'g', name: 'de guisantes'}, {amount: 2, unit: '', name: 'zanahorias'}, {amount: 2, unit: '', name: 'patatas'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 500, unit: 'ml', name: 'de caldo de carne'}], steps: [{text: "Sella la ternera en una olla. Reserva."}, {text: "Sofríe la cebolla. Añade la ternera y el vino."}, {text: "Cubre con caldo y cuece 1 hora.", duration: 60}, {text: "Añade las patatas, zanahorias y guisantes. Cuece 20 minutos más.", duration: 20}] },
                { id: "solomillo-al-whisky", name: "Solomillo al Whisky", category: "Segundo", time: "25 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Solomillo+Whisky", ingredients: [{amount: 1, unit: '', name: 'solomillo de cerdo'}, {amount: 100, unit: 'ml', name: 'de whisky'}, {amount: 4, unit: '', name: 'dientes de ajo'}, {amount: 1, unit: '', name: 'zumo de limón'}, {amount: null, unit: '', name: 'Aceite de oliva'}], steps: [{text: "Corta el solomillo en medallones y dóralos. Reserva."}, {text: "En la misma sartén, dora los ajos laminados."}, {text: "Vierte el whisky y el zumo de limón. Deja que reduzca."}, {text: "Incorpora de nuevo el solomillo y cocina un par de minutos.", duration: 2}] },
                { id: "atun-encebollado", name: "Atún Encebollado", category: "Segundo", time: "30 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Atún+Encebollado", ingredients: [{amount: 4, unit: 'rodajas', name: 'de atún fresco'}, {amount: 2, unit: '', name: 'cebollas grandes'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 1, unit: '', name: 'hoja de laurel'}, {amount: null, unit: '', name: 'Orégano'}], steps: [{text: "Corta las cebollas en juliana y póchalas a fuego lento.", duration: 15}, {text: "Cuando esté transparente, añade el vino y el laurel. Cuece 10 minutos.", duration: 10}, {text: "Marca el atún en una plancha, vuelta y vuelta."}, {text: "Sirve el atún con la cebolla por encima y espolvorea orégano."}] },
                { id: "caldereta-cordero", name: "Caldereta de Cordero", category: "Segundo", time: "2 horas", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Caldereta", ingredients: [{amount: 1, unit: 'kg', name: 'de cordero en trozos'}, {amount: 1, unit: '', name: 'cebolla'}, {amount: 2, unit: '', name: 'pimientos'}, {amount: 2, unit: '', name: 'tomates'}, {amount: 4, unit: '', name: 'dientes de ajo'}, {amount: 150, unit: 'ml', name: 'de vino tinto'}, {amount: 1, unit: 'cucharadita', name: 'de pimentón'}], steps: [{text: "Dora el cordero en una cazuela. Reserva."}, {text: "Sofríe las verduras picadas."}, {text: "Añade pimentón, el cordero y el vino. Deja reducir."}, {text: "Cubre con agua o caldo y cuece a fuego lento 1.5 - 2 horas.", duration: 105}] },
                // 20 Postres
                { id: "crema-catalana", name: "Crema Catalana", category: "Postre", time: "25 min + reposo", servings: 6, difficulty: "Medio", image: "https://images.unsplash.com/photo-1621244249146-2169820786a3?q=80&w=800", ingredients: [{amount: 1, unit: 'litro', name: 'de leche'}, {amount: 8, unit: '', name: 'yemas de huevo'}, {amount: 200, unit: 'g', name: 'de azúcar'}, {amount: 40, unit: 'g', name: 'de maicena'}, {amount: 1, unit: '', name: 'piel de limón y naranja'}, {amount: 1, unit: 'rama', name: 'de canela'}], steps: [{text: "Infusiona la leche con los cítricos y la canela."}, {text: "Mezcla yemas, azúcar y maicena."}, {text: "Cuela la leche y mézclala con las yemas."}, {text: "Cocina a fuego lento hasta que espese. Enfría.", duration: 10}, {text: "Quema azúcar en la superficie antes de servir."}] },
                { id: "tarta-de-santiago", name: "Tarta de Santiago", category: "Postre", time: "45 min", servings: 10, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Tarta+Santiago", ingredients: [{amount: 250, unit: 'g', name: 'de almendra molida'}, {amount: 250, unit: 'g', name: 'de azúcar'}, {amount: 5, unit: '', name: 'huevos'}, {amount: 1, unit: '', name: 'ralladura de limón'}, {amount: null, unit: '', name: 'Azúcar glas para decorar'}], steps: [{text: "Mezcla la almendra y el azúcar."}, {text: "Añade los huevos de uno en uno, batiendo bien."}, {text: "Incorpora la ralladura de limón."}, {text: "Vierte en un molde engrasado y hornea a 170°C durante 30-35 minutos.", duration: 32}, {text: "Deja enfriar y decora con la Cruz de Santiago hecha con azúcar glas."}] },
                { id: "arroz-con-leche", name: "Arroz con Leche", category: "Postre", time: "50 min", servings: 6, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1599043513901-3c5b52f6b3a2?q=80&w=800", ingredients: [{amount: 1, unit: 'litro', name: 'de leche entera'}, {amount: 100, unit: 'g', name: 'de arroz'}, {amount: 120, unit: 'g', name: 'de azúcar'}, {amount: 1, unit: '', name: 'piel de limón'}, {amount: 1, unit: 'rama', name: 'de canela'}], steps: [{text: "Pon a cocer el arroz con la leche, la piel de limón y la canela."}, {text: "Cocina a fuego muy lento durante 45 minutos, removiendo a menudo.", duration: 45}, {text: "Añade el azúcar y cuece 5 minutos más.", duration: 5}, {text: "Retira la canela y el limón. Sirve frío o templado con canela en polvo."}] },
                { id: "flan-de-huevo", name: "Flan de Huevo", category: "Postre", time: "60 min", servings: 8, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1617344539352-75c6d5b0a3c4?q=80&w=800", ingredients: [{amount: 5, unit: '', name: 'huevos'}, {amount: 500, unit: 'ml', name: 'de leche'}, {amount: 150, unit: 'g', name: 'de azúcar'}, {amount: null, unit: '', name: 'Caramelo líquido'}], steps: [{text: "Bate los huevos con el azúcar."}, {text: "Calienta la leche y viértela sobre los huevos sin dejar de batir."}, {text: "Cubre el fondo de una flanera con caramelo líquido."}, {text: "Vierte la mezcla en la flanera y cocina al baño maría en el horno a 180°C durante 45-50 minutos.", duration: 47}] },
                { id: "torrijas", name: "Torrijas de Leche", category: "Postre", time: "30 min", servings: 8, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1584879555239-444f0b784a3c?q=80&w=800", ingredients: [{amount: 1, unit: 'barra', name: 'de pan del día anterior'}, {amount: 1, unit: 'litro', name: 'de leche'}, {amount: 150, unit: 'g', name: 'de azúcar'}, {amount: 1, unit: 'rama', name: 'de canela'}, {amount: 1, unit: '', name: 'piel de limón'}, {amount: 2, unit: '', name: 'huevos'}, {amount: null, unit: '', name: 'Aceite para freír'}], steps: [{text: "Infusiona la leche con azúcar, canela y limón."}, {text: "Corta el pan en rebanadas gruesas y empápalas en la leche infusionada."}, {text: "Pasa las rebanadas por huevo batido."}, {text: "Fríelas en aceite caliente hasta que estén doradas."}, {text: "Escúrrelas y rebózalas en una mezcla de azúcar y canela."}] },
                { id: "leche-frita", name: "Leche Frita", category: "Postre", time: "30 min + reposo", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Leche+Frita", ingredients: [{amount: 500, unit: 'ml', name: 'de leche'}, {amount: 100, unit: 'g', name: 'de azúcar'}, {amount: 50, unit: 'g', name: 'de maicena'}, {amount: 1, unit: 'rama', name: 'de canela'}, {amount: 1, unit: '', name: 'piel de limón'}, {amount: 2, unit: '', name: 'huevos y harina para rebozar'}], steps: [{text: "Disuelve la maicena en un poco de leche fría."}, {text: "Calienta el resto de la leche con azúcar, canela y limón. Cuela."}, {text: "Añade la mezcla de maicena y cocina hasta que espese mucho.", duration: 10}, {text: "Vierte en una fuente y deja enfriar hasta que solidifique.", duration: 180}, {text: "Corta en porciones, pasa por harina y huevo y fríe. Rebózalas en azúcar y canela."}] },
                { id: "filloas-gallegas", name: "Filloas Gallegas", category: "Postre", time: "30 min", servings: 12, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Filloas", ingredients: [{amount: 250, unit: 'ml', name: 'de leche'}, {amount: 3, unit: '', name: 'huevos'}, {amount: 100, unit: 'g', name: 'de harina'}, {amount: 50, unit: 'g', name: 'de azúcar'}, {amount: null, unit: '', name: 'Un trozo de tocino para engrasar'}], steps: [{text: "Bate los huevos con el azúcar."}, {text: "Añade la leche y la harina tamizada. Mezcla hasta obtener una masa líquida y sin grumos."}, {text: "Unta una sartén caliente con el tocino."}, {text: "Vierte un cucharón de masa y extiéndela para que quede una capa fina."}, {text: "Cocina por ambos lados y repite hasta acabar la masa. Sírvelas con azúcar, miel o mermelada."}] },
                { id: "tarta-de-queso-la-vina", name: "Tarta de Queso 'La Viña'", category: "Postre", time: "60 min", servings: 12, difficulty: "Fácil", image: "https://images.unsplash.com/photo-1567613768463-b9254d39994f?q=80&w=800", ingredients: [{amount: 1, unit: 'kg', name: 'de queso crema'}, {amount: 500, unit: 'ml', name: 'de nata (35% M.G.)'}, {amount: 7, unit: '', name: 'huevos'}, {amount: 400, unit: 'g', name: 'de azúcar'}, {amount: 1, unit: 'cucharada', name: 'de harina'}], steps: [{text: "Bate el queso crema con el azúcar."}, {text: "Añade los huevos uno a uno."}, {text: "Incorpora la nata y la harina. Mezcla bien."}, {text: "Vierte en un molde forrado con papel de horno arrugado."}, {text: "Hornea a 210°C durante 40-50 minutos. El centro debe quedar tembloroso.", duration: 45}, {text: "Deja enfriar por completo antes de desmoldar."}] },
                { id: "panellets", name: "Panellets", category: "Postre", time: "40 min", servings: 20, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Panellets", ingredients: [{amount: 250, unit: 'g', name: 'de almendra molida'}, {amount: 200, unit: 'g', name: 'de azúcar'}, {amount: 1, unit: '', name: 'clara de huevo'}, {amount: 1, unit: '', name: 'ralladura de limón'}, {amount: 100, unit: 'g', name: 'de piñones para decorar'}], steps: [{text: "Mezcla la almendra, el azúcar y la ralladura de limón."}, {text: "Añade la clara de huevo y amasa hasta obtener un mazapán."}, {text: "Forma bolitas, rebózalas en piñones."}, {text: "Píntalas con yema de huevo y hornea a 180°C durante 10-15 minutos.", duration: 12}] },
                { id: "tocino-de-cielo", name: "Tocino de Cielo", category: "Postre", time: "50 min", servings: 8, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Tocino+Cielo", ingredients: [{amount: 10, unit: '', name: 'yemas de huevo'}, {amount: 250, unit: 'g', name: 'de azúcar'}, {amount: 150, unit: 'ml', name: 'de agua'}, {amount: null, unit: '', name: 'Caramelo líquido'}], steps: [{text: "Haz un almíbar a punto de bola con el agua y el azúcar."}, {text: "Bate las yemas en un bol."}, {text: "Vierte el almíbar templado sobre las yemas en un hilo fino, sin dejar de batir."}, {text: "Cubre el fondo de un molde con caramelo."}, {text: "Vierte la mezcla y cocina al baño maría en el horno a 160°C durante 30 minutos.", duration: 30}] },
                { id: "piononos", name: "Piononos de Santa Fe", category: "Postre", time: "40 min", servings: 12, difficulty: "Difícil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Piononos", ingredients: [{amount: 2, unit: '', name: 'huevos'}, {amount: 60, unit: 'g', name: 'de azúcar'}, {amount: 60, unit: 'g', name: 'de harina'}, {amount: 100, unit: 'g', name: 'de azúcar para almíbar'}, {amount: 100, unit: 'ml', name: 'de agua'}, {amount: 2, unit: '', name: 'yemas para crema'}, {amount: 50, unit: 'g', name: 'de azúcar para crema'}, {amount: 250, unit: 'ml', name: 'de leche'}], steps: [{text: "Hornea una plancha fina de bizcocho y enróllala en caliente.", duration: 8}, {text: "Prepara un almíbar y empapa el bizcocho."}, {text: "Haz una crema pastelera con las yemas, azúcar y leche. Rellena el bizcocho y enróllalo de nuevo."}, {text: "Corta en porciones, corona con más crema y quema azúcar por encima."}] },
                { id: "pestinos", name: "Pestiños", category: "Postre", time: "50 min", servings: 20, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Pestiños", ingredients: [{amount: 250, unit: 'g', name: 'de harina'}, {amount: 100, unit: 'ml', name: 'de vino blanco'}, {amount: 100, unit: 'ml', name: 'de aceite de oliva'}, {amount: 1, unit: '', name: 'ralladura de limón'}, {amount: 200, unit: 'g', name: 'de miel'}, {amount: null, unit: '', name: 'Ajonjolí'}], steps: [{text: "Calienta el aceite con la piel de limón. Deja enfriar."}, {text: "Mezcla la harina, el vino y el aceite. Amasa."}, {text: "Estira la masa muy fina, corta cuadrados y dobla las puntas opuestas hacia el centro."}, {text: "Fríe en abundante aceite caliente."}, {text: "Pasa los pestiños por miel caliente y espolvorea ajonjolí."}] },
                { id: "tarta-de-la-abuela", name: "Tarta de la Abuela", category: "Postre", time: "30 min + reposo", servings: 10, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Tarta+Abuela", ingredients: [{amount: 2, unit: 'paquetes', name: 'de galletas María'}, {amount: 500, unit: 'ml', name: 'de leche'}, {amount: 1, unit: 'sobre', name: 'de flan en polvo'}, {amount: 200, unit: 'g', name: 'de chocolate para postres'}, {amount: 100, unit: 'ml', name: 'de nata'}], steps: [{text: "Prepara el flan siguiendo las instrucciones del paquete."}, {text: "En un molde, pon una capa de galletas mojadas en leche."}, {text: "Cubre con una capa de flan. Repite las capas."}, {text: "Funde el chocolate con la nata y cubre la tarta."}, {text: "Deja enfriar en la nevera varias horas.", duration: 240}] },
                { id: "cuajada", name: "Cuajada con Miel y Nueces", category: "Postre", time: "10 min", servings: 6, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Cuajada", ingredients: [{amount: 1, unit: 'litro', name: 'de leche de oveja'}, {amount: 1, unit: 'cucharadita', name: 'de cuajo'}, {amount: null, unit: '', name: 'Miel'}, {amount: null, unit: '', name: 'Nueces'}], steps: [{text: "Calienta la leche hasta que esté tibia (unos 37°C)."}, {text: "Añade unas gotas de cuajo y remueve."}, {text: "Vierte en recipientes individuales y deja reposar sin mover hasta que cuaje.", duration: 60}, {text: "Sirve con un chorro de miel y nueces por encima."}] },
                { id: "rosquillas-de-anis", name: "Rosquillas de Anís", category: "Postre", time: "40 min", servings: 24, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Rosquillas", ingredients: [{amount: 3, unit: '', name: 'huevos'}, {amount: 200, unit: 'g', name: 'de azúcar'}, {amount: 100, unit: 'ml', name: 'de anís'}, {amount: 100, unit: 'ml', name: 'de aceite'}, {amount: 500, unit: 'g', name: 'de harina'}, {amount: 1, unit: 'sobre', name: 'de levadura'}], steps: [{text: "Bate los huevos con el azúcar. Añade el aceite y el anís."}, {text: "Incorpora la harina y la levadura poco a poco hasta formar una masa manejable."}, {text: "Forma las rosquillas."}, {text: "Fríelas en aceite caliente y rebózalas en azúcar."}] },
                { id: "yemas-santa-teresa", name: "Yemas de Santa Teresa", category: "Postre", time: "30 min", servings: 12, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Yemas", ingredients: [{amount: 6, unit: '', name: 'yemas de huevo'}, {amount: 100, unit: 'g', name: 'de azúcar'}, {amount: 50, unit: 'ml', name: 'de agua'}, {amount: 1, unit: '', name: 'ralladura de limón'}], steps: [{text: "Haz un almíbar a punto de bola con el agua y el azúcar."}, {text: "Bate las yemas y vierte el almíbar en un hilo fino."}, {text: "Cocina la mezcla al baño maría, sin dejar de remover, hasta que espese.", duration: 10}, {text: "Deja enfriar la masa. Forma bolitas y rebózalas en azúcar."}] },
                { id: "goxua", name: "Goxua", category: "Postre", time: "40 min", servings: 6, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Goxua", ingredients: [{amount: 200, unit: 'ml', name: 'de nata montada'}, {amount: 300, unit: 'ml', name: 'de crema pastelera'}, {amount: 6, unit: '', name: 'bizcochos de soletilla'}, {amount: null, unit: '', name: 'Caramelo líquido'}], steps: [{text: "En un vaso o copa, pon una base de nata montada."}, {text: "Cubre con trozos de bizcocho empapados en almíbar."}, {text: "Añade una capa generosa de crema pastelera."}, {text: "Quema azúcar por encima con un soplete o sirve con caramelo líquido."}] },
                { id: "brazo-de-gitano", name: "Brazo de Gitano", category: "Postre", time: "50 min", servings: 8, difficulty: "Medio", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Brazo+Gitano", ingredients: [{amount: 4, unit: '', name: 'huevos'}, {amount: 120, unit: 'g', name: 'de azúcar'}, {amount: 120, unit: 'g', name: 'de harina'}, {amount: 300, unit: 'ml', name: 'de crema pastelera, nata o trufa para rellenar'}, {amount: null, unit: '', name: 'Azúcar glas'}], steps: [{text: "Bate los huevos con el azúcar hasta que blanqueen."}, {text: "Añade la harina con movimientos envolventes."}, {text: "Extiende en una bandeja de horno con papel y hornea 10 min a 180°C.", duration: 10}, {text: "Vuelca sobre un paño húmedo, enrolla y deja enfriar."}, {text: "Desenrolla, rellena y vuelve a enrollar. Espolvorea azúcar glas."}] },
                { id: "peras-al-vino", name: "Peras al Vino", category: "Postre", time: "40 min", servings: 4, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Peras+al+Vino", ingredients: [{amount: 4, unit: '', name: 'peras'}, {amount: 500, unit: 'ml', name: 'de vino tinto'}, {amount: 150, unit: 'g', name: 'de azúcar'}, {amount: 1, unit: 'rama', name: 'de canela'}, {amount: 1, unit: '', name: 'piel de limón'}], steps: [{text: "Pela las peras dejando el rabito."}, {text: "En una cazuela, pon el vino, azúcar, canela y limón."}, {text: "Introduce las peras y cuece a fuego lento durante 30 minutos, dándoles la vuelta a mitad de cocción.", duration: 30}, {text: "Deja enfriar las peras en el propio almíbar."}] },
                { id: "miguelitos-de-la-roda", name: "Miguelitos de La Roda", category: "Postre", time: "25 min", servings: 12, difficulty: "Fácil", image: "https://placehold.co/800x600/a38b72/4a2e0a?text=Miguelitos", ingredients: [{amount: 1, unit: 'plancha', name: 'de hojaldre'}, {amount: 200, unit: 'ml', name: 'de crema pastelera'}, {amount: null, unit: '', name: 'Azúcar glas'}], steps: [{text: "Precalienta el horno a 200°C."}, {text: "Corta el hojaldre en cuadrados y hornéalos hasta que se inflen y estén dorados.", duration: 15}, {text: "Déjalos enfriar."}, {text: "Ábrelos por la mitad con cuidado y rellénalos con crema pastelera."}, {text: "Espolvorea con abundante azúcar glas."}] }
            ];
            
            function initializeUI() {
                let recipeHTML = '';
                allRecipes.forEach(recipe => {
                    const searchTerms = `${recipe.name.toLowerCase()} ${recipe.ingredients.map(i => i.name).join(' ').toLowerCase()}`;
                    recipeHTML += `
                        <div class="recipe-card" data-id="${recipe.id}" data-category="${recipe.category}" data-search="${searchTerms}">
                            <div class="relative bg-white dark:bg-stone-800 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-transform duration-300 cursor-pointer h-full flex flex-col">
                                <img src="${recipe.image}" alt="[Imagen de ${recipe.name}]" class="w-full h-40 object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x300/d1c4b5/4a2e0a?text=Receta';">
                                <div class="absolute top-2 left-2 bg-amber-800 text-white text-xs font-semibold px-2 py-1 rounded-full">${recipe.category}</div>
                                <button class="favorite-btn absolute top-2 right-2 bg-white/80 rounded-full p-2 hover:bg-white dark:bg-stone-700/80 dark:hover:bg-stone-600 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z" /></svg>
                                </button>
                                <div class="p-4 flex-grow flex flex-col">
                                    <h3 class="font-bold text-lg text-amber-900 dark:text-amber-500 truncate">${recipe.name}</h3>
                                    <div class="flex items-center text-sm text-gray-500 dark:text-stone-400 mt-2">
                                        <span>${recipe.time}</span><span class="mx-2">|</span><span>${recipe.difficulty}</span>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                dom.grid.innerHTML = recipeHTML;
                addCardEventListeners();
            }
            
            function addCardEventListeners() {
                document.querySelectorAll('.recipe-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const recipe = allRecipes.find(r => r.id === card.dataset.id);
                        if (recipe) showRecipeDetail(recipe);
                    });
                    card.querySelector('.favorite-btn').addEventListener('click', e => {
                        e.stopPropagation();
                        toggleFavorite(card.dataset.id);
                    });
                });
            }
            
            initializeUI();

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    dom.userInfo.textContent = `Sincronizando...`;
                    await loadUserData();
                    updateFavoriteIcons();
                    dom.userInfo.textContent = `ID de sesión: ${userId.substring(0,8)}...`;
                } else {
                    signInAnonymously(auth).catch((error) => console.error("Error login anónimo:", error));
                }
            });

            async function loadUserData() {
                if (!userId) return;
                const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/profile`);
                const userDoc = await getDoc(userDocRef);
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    userFavorites = data.favorites || [];
                    shoppingList = data.shoppingList || [];
                    userNotes = data.notes || {};
                }
            }

            async function saveData(data) {
                if (!userId) return;
                const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/data/profile`);
                await setDoc(userDocRef, data, { merge: true });
            }

            async function toggleFavorite(recipeId) {
                if (!userId) return;
                const isFavorite = userFavorites.includes(recipeId);
                userFavorites = isFavorite ? userFavorites.filter(id => id !== recipeId) : [...userFavorites, recipeId];
                
                updateFavoriteIcons();
                applyFilters();

                await saveData({ favorites: userFavorites });
            }

            function updateFavoriteIcons() {
                document.querySelectorAll('.recipe-card').forEach(card => {
                    const heartIcon = card.querySelector('.favorite-btn svg');
                    if (userFavorites.includes(card.dataset.id)) {
                        heartIcon.classList.add('text-red-500', 'fill-current');
                        heartIcon.classList.remove('text-gray-600', 'dark:text-gray-400');
                    } else {
                        heartIcon.classList.remove('text-red-500', 'fill-current');
                        heartIcon.classList.add('text-gray-600', 'dark:text-gray-400');
                    }
                });
            }

            function applyFilters() {
                const searchTerm = dom.search.value.toLowerCase();
                let visibleCount = 0;

                document.querySelectorAll('.recipe-card').forEach(card => {
                    const id = card.dataset.id;
                    const category = card.dataset.category;
                    const searchData = card.dataset.search;

                    const isFavorite = userFavorites.includes(id);
                    
                    const categoryMatch = currentCategory === 'all' || category === currentCategory;
                    const searchMatch = searchTerm === '' || searchData.includes(searchTerm);
                    const favoriteMatch = currentFilter !== 'favorites' || isFavorite;
                    
                    if (categoryMatch && searchMatch && favoriteMatch) {
                        card.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        card.classList.add('hidden');
                    }
                });

                dom.noResults.style.display = visibleCount === 0 ? 'block' : 'none';
            }
            
            function showRecipeDetail(recipe) {
                dom.modalContent.innerHTML = `
                    <div class="p-6 md:p-8">
                        <div class="flex justify-between items-start">
                            <h2 class="text-3xl font-bold text-amber-900 dark:text-amber-500 mb-4">${recipe.name}</h2>
                            <button id="closeModalBtn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-stone-700 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        </div>
                        <img src="${recipe.image}" alt="[Imagen de ${recipe.name}]" class="w-full h-64 object-cover rounded-lg mb-6" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x400/d1c4b5/4a2e0a?text=Receta';">
                        <div id="recipe-content-normal">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="text-xl font-semibold border-b-2 border-amber-200 dark:border-amber-800 pb-2">Ingredientes</h4>
                                        <div class="flex items-center gap-2">
                                            <label for="servings-input" class="text-sm">Porciones:</label>
                                            <input type="number" id="servings-input" value="${recipe.servings}" min="1" class="w-16 p-1 border rounded dark:bg-stone-700 dark:border-stone-600">
                                        </div>
                                    </div>
                                    <ul id="ingredient-list" class="list-disc list-inside space-y-2 text-gray-700 dark:text-stone-300"></ul>
                                </div>
                                <div>
                                    <h4 class="text-xl font-semibold mb-3 border-b-2 border-amber-200 dark:border-amber-800 pb-2">Pasos</h4>
                                    <ol id="steps-list" class="list-decimal list-inside space-y-3 text-gray-700 dark:text-stone-300"></ol>
                                </div>
                            </div>
                             <div class="modal-buttons-container text-center mt-8 flex flex-wrap gap-4 justify-center">
                                <button id="add-to-cart-btn" class="bg-green-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-green-700 transition shadow-lg">Añadir a la Compra</button>
                                <button id="printRecipeBtn" class="bg-gray-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-gray-600 transition shadow-lg">Imprimir</button>
                                <button id="shareRecipeBtn" class="bg-blue-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-blue-700 transition shadow-lg">Compartir</button>
                            </div>
                        </div>
                    </div>`;
                
                const servingsInput = document.getElementById('servings-input');
                const ingredientList = document.getElementById('ingredient-list');
                const stepsList = document.getElementById('steps-list');

                function renderIngredients(servings) {
                    ingredientList.innerHTML = recipe.ingredients.map(ing => {
                        let amount = ing.amount;
                        if(amount) {
                            amount = (amount / recipe.servings) * servings;
                            if (amount % 1 !== 0) {
                                amount = amount.toFixed(1);
                            }
                        }
                        return `<li>${amount ? amount : ''}${ing.unit ? ' ' + ing.unit : ''} ${ing.name}</li>`;
                    }).join('');
                }

                function renderSteps() {
                    stepsList.innerHTML = '';
                    recipe.steps.forEach(step => {
                        const li = document.createElement('li');
                        li.className = 'flex justify-between items-center gap-2';
                        li.innerHTML = `<span>${step.text}</span>`;
                        if (step.duration) {
                            const timerBtn = document.createElement('button');
                            timerBtn.className = 'timer-btn p-1 rounded-full hover:bg-amber-200 dark:hover:bg-stone-600 transition flex-shrink-0';
                            timerBtn.title = `Iniciar temporizador de ${step.duration} minutos`;
                            timerBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-700 dark:text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                            timerBtn.onclick = () => startTimer(step.duration, recipe.name);
                            li.appendChild(timerBtn);
                        }
                        stepsList.appendChild(li);
                    });
                }

                renderIngredients(recipe.servings);
                renderSteps();
                servingsInput.addEventListener('change', (e) => renderIngredients(e.target.value));

                dom.modal.style.display = 'flex';
                setTimeout(() => dom.modalContent.classList.add('scale-100'), 10);
                document.getElementById('closeModalBtn').addEventListener('click', closeModal);
                document.getElementById('printRecipeBtn').addEventListener('click', () => window.print());
                
                const shareBtn = document.getElementById('shareRecipeBtn');
                if (navigator.share) {
                    shareBtn.addEventListener('click', async () => {
                        try {
                            await navigator.share({
                                title: recipe.name,
                                text: `¡Mira esta receta de ${recipe.name}!`,
                                url: window.location.href,
                            });
                        } catch (err) {
                            console.error('Error al compartir:', err);
                        }
                    });
                } else {
                    shareBtn.style.display = 'none';
                }

                document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                    addToShoppingList(recipe);
                    alert(`${recipe.name} añadida a la lista de la compra.`);
                });
            }
            
            function closeModal() {
                dom.modalContent.classList.remove('scale-100');
                setTimeout(() => { dom.modal.style.display = 'none'; dom.modalContent.innerHTML = ''; }, 300);
            }

            // --- MODO OSCURO ---
            function setupTheme() {
                if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    dom.lightIcon.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    dom.darkIcon.classList.remove('hidden');
                }
            }

            dom.themeToggle.addEventListener('click', function() {
                dom.darkIcon.classList.toggle('hidden');
                dom.lightIcon.classList.toggle('hidden');
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    }
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
            });

            setupTheme();

            // --- EVENT LISTENERS ---
            dom.search.addEventListener('input', applyFilters);

            dom.filterAllBtn.addEventListener('click', () => {
                currentFilter = 'all';
                dom.filterAllBtn.classList.add('active'); dom.filterFavBtn.classList.remove('active');
                applyFilters();
            });
            dom.filterFavBtn.addEventListener('click', () => {
                currentFilter = 'favorites';
                dom.filterFavBtn.classList.add('active'); dom.filterAllBtn.classList.remove('active');
                applyFilters();
            });
            
            dom.categoryFilters.addEventListener('click', (e) => {
                if (e.target.matches('.category-btn')) {
                    currentCategory = e.target.dataset.category;
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    applyFilters();
                }
            });
            
            dom.modal.addEventListener('click', (event) => { if (event.target === dom.modal) closeModal(); });
            
            dom.filterAllBtn.classList.add('active');
            
            // --- COPYRIGHT YEAR ---
            dom.copyrightYear.textContent = new Date().getFullYear();
        }

        // Ejecuta la app cuando el DOM esté listo
        runRecipeApp();
    </script>
</body>
</html>
