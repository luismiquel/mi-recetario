<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Recetario EspaÃ±ol con 160 recetas. BÃºsqueda rÃ¡pida, voz clara manos libres, modo guiado, alto contraste, letra grande y lista de la compra." />
  <title>Recetario EspaÃ±ol â€“ 160 recetas</title>

  <meta name="theme-color" content="#78350f" />
  <meta name="theme-color" content="#78350f" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)">

  <link rel="manifest" href="./manifest.json" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  
  <!-- Favicon sin 404 -->
  <link rel="icon" type="image/png"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=" />

  <link rel="stylesheet" href="./styles.css">

  <style>
    :root{ --base-font:16px; }
    html{ font-size: var(--base-font); }
    body{ -webkit-tap-highlight-color: transparent; }
    /* Foco visible */
    *:focus { outline: 3px solid #4f46e5; outline-offset: 2px; }

    /* Componentes de UI */
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:1rem;padding:.6rem 1rem;font-weight:600}
    .btn-primary{background:#92400e;color:#fff}.btn-primary:active{transform:scale(.98)}
    .btn-ghost{background:transparent}.btn-ghost:active{transform:scale(.98)}
    .tab{padding:.5rem .75rem;border-radius:.75rem;font-size:.9rem;font-weight:700}
    .tab[aria-selected="true"]{background:#92400e;color:#fff}
    .card{border-radius:1rem;border:1px solid rgba(120,113,108,.25);overflow:hidden;background:#fff}
    .dark .card{background:#1f2937;border-color:#374151}

    /* Modos de accesibilidad */
    .hc *{ color:#000 !important; background:#fff !important; }
    .hc .tab[aria-selected="true"]{ background:#000 !important; color:#fff !important; }

    /* Drawer y Skip Link */
    .drawer{position:fixed;top:env(safe-area-inset-top,0);right:0;bottom:0;width:380px;max-width:100%;background:#fff;color:#111;box-shadow:-4px 0 20px rgba(0,0,0,.2);transform:translateX(100%);transition:.25s;z-index:60}
    .dark .drawer{background:#111827;color:#e5e7eb}
    .drawer.open{transform:translateX(0)}
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{left:1rem;top:1rem;width:auto;height:auto;padding:.5rem .75rem;background:#fff;color:#111;border-radius:.5rem;box-shadow:0 2px 6px rgba(0,0,0,.2)}

    /* SubtÃ­tulos de voz */
    #ttsCaption{position:fixed;left:0;right:0;bottom:env(safe-area-inset-bottom,0);margin:0 auto;max-width:700px;background:rgba(17,24,39,.92);color:#fff;border-radius:12px 12px 0 0;padding:.6rem .8rem;font-size:.95rem;line-height:1.35;z-index:70;display:none}
    #ttsCaption.show{display:block}

    /* Imprimir */
    @media print{header,.no-print,#shoppingDrawer,#ttsCaption{display:none!important}}

    /* Scrollbars */
    *::-webkit-scrollbar{ width:12px; height:12px }
    *::-webkit-scrollbar-thumb{ background-color: rgba(120,113,108,.5); border-radius: 8px }
    *::-webkit-scrollbar-track{ background: transparent }

    /* HUD del asistente de voz */
    #voiceHUD{display:flex;align-items:center;gap:.5rem;margin-top:.25rem;font-size:.85rem;color:#6b7280}
    #voiceDot{width:10px;height:10px;border-radius:9999px;background:#9ca3af;box-shadow:0 0 0 0 rgba(16,185,129,.0);transition:.12s}
    #voiceWave{position:relative;display:block;width:140px;height:10px;border-radius:9999px;background:rgba(120,113,108,.25);overflow:hidden}
    #voiceWave > i{position:absolute;left:0;top:0;bottom:0;width:0;background:#10b981;transition:width .08s ease}
    .talking #voiceDot{background:#10b981;box-shadow:0 0 12px 3px rgba(16,185,129,.45)}
    .listening #voiceDot{background:#f59e0b}
    .disabled #voiceDot{background:#9ca3af}
  </style>
</head>
<body class="dark:bg-stone-900 dark:text-stone-200">
  <a href="#main" class="skip-link">Saltar al contenido principal</a>

  <noscript>
    <div style="padding:1rem;margin:1rem;border:1px solid #e5e7eb;border-radius:12px;background:#fff;color:#111">
      Esta aplicaciÃ³n necesita JavaScript para funcionar (bÃºsqueda, voz, cocina guiada y lista de la compra).
    </div>
  </noscript>

  <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4" id="app">
    <header class="flex items-center justify-between gap-3 mb-4">
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold">Recetario EspaÃ±ol â€“ 160 recetas</h1>
        <p class="text-sm text-stone-600 dark:text-stone-400">Voz manos libres Â· Contraste Â· Letra grande Â· Lista de la compra.</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="toggleTheme" class="btn btn-ghost" title="Cambiar tema" aria-label="Cambiar tema">ğŸŒ™/â˜€ï¸</button>
        <button id="toggleContrast" class="btn btn-ghost" title="Alto contraste" aria-label="Alto contraste">ğŸŒ“</button>
        <button id="fontMinus" class="btn btn-ghost" title="Reducir letra" aria-label="Reducir letra">Aâˆ’</button>
        <button id="fontPlus" class="btn btn-ghost" title="Aumentar letra" aria-label="Aumentar letra">A+</button>
        <button id="openShopping" class="btn btn-ghost" title="Abrir lista de la compra" aria-label="Lista de la compra">ğŸ§º</button>
      </div>
    </header>

    <section class="card p-4 mb-4" aria-label="BÃºsqueda y filtros">
      <div class="flex flex-col md:flex-row gap-3 items-stretch md:items-end">
        <div class="flex-1">
          <label for="search" class="block text-sm font-medium mb-1">Buscar</label>
          <input id="search" type="search" inputmode="search" placeholder="Nombre, ingredienteâ€¦ (Ctrl+/)"
                class="w-full rounded-xl border border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-900 px-3 py-2" />
        </div>
        <div class="flex items-center gap-2" role="tablist" aria-label="CategorÃ­as">
          <button class="tab" role="tab" id="tab-todas" aria-selected="true" data-cat="Todas" title="Mostrar todas">Todas</button>
          <button class="tab" role="tab" id="tab-aperitivo" aria-selected="false" data-cat="Aperitivo" title="Mostrar aperitivos">Aperitivos</button>
          <button class="tab" role="tab" id="tab-primero" aria-selected="false" data-cat="Primero" title="Mostrar primeros">Primeros</button>
          <button class="tab" role="tab" id="tab-segundo" aria-selected="false" data-cat="Segundo" title="Mostrar segundos">Segundos</button>
          <button class="tab" role="tab" id="tab-postre" aria-selected="false" data-cat="Postre" title="Mostrar postres">Postres</button>
        </div>
        <div class="flex items-end gap-2">
          <label class="text-sm" for="voiceRate">Voz:</label>
          <select id="voiceRate" class="rounded-lg border px-2 py-1 dark:bg-stone-900 dark:border-stone-700" aria-label="Velocidad de lectura en voz alta">
            <option value="0.8">Lenta</option>
            <option value="0.9" selected>Clara</option>
            <option value="1.0">Normal</option>
          </select>

          <label for="autoListen" class="text-sm select-none" title="Escuchar sin pulsar">
            <input id="autoListen" type="checkbox" class="align-middle mr-1" checked> Auto
          </label>

          <button id="toggleMic" class="btn btn-primary" title="Reconectar reconocimiento de voz" aria-label="Reconectar reconocimiento de voz">ğŸ¤ Reconectar voz</button>
        </div>
      </div>
      <div id="readerStatus" class="text-xs text-stone-500 mt-2" aria-live="polite"></div>
      <div id="heard" class="text-xs mt-1 text-stone-500">ğŸ§ OÃ­do: <span id="heardText">â€”</span></div>
    </section>

    <section class="mb-2 text-sm text-stone-600 dark:text-stone-400">
      <span id="countLabel">Mostrando 0 recetas.</span>
    </section>

    <main id="main" aria-labelledby="countLabel">
      <div id="recipesGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4" role="region" aria-label="Listado de recetas"></div>
      <div id="emptyState" class="hidden text-center text-stone-600 dark:text-stone-400 mt-10">No hay resultados.</div>
    </main>

    <div id="detailModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 no-print" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
      <div class="card max-w-3xl w-full">
        <div class="p-3 border-b border-stone-200 dark:border-stone-700 flex items-center justify-between">
          <h3 id="detailTitle" class="text-xl font-semibold">Detalle</h3>
          <button id="closeDetail" class="btn btn-ghost" aria-label="Cerrar detalle" title="Cerrar">âœ•</button>
        </div>
        <div class="p-4 grid gap-4 md:grid-cols-2">
          <div>
            <img id="detailImg"
                 src="https://placehold.co/800x500/78350f/ffffff?text=Receta"
                 alt=""
                 class="w-full h-48 object-cover rounded-lg"
                 width="800" height="500"
                 loading="lazy"
                 decoding="async"
                 onerror="this.onerror=null;this.src='https://placehold.co/800x500/78350f/ffffff?text=Receta';">
            <p id="detailMeta" class="mt-2 text-sm text-stone-600 dark:text-stone-400"></p>
            <div class="mt-3 flex flex-wrap gap-2">
              <button id="btnReadAll" class="btn btn-ghost" aria-label="Leer receta en voz alta" title="Leer receta">ğŸ”ˆ Leer</button>
              <button id="btnGuided" class="btn btn-primary" aria-label="Iniciar cocina guiada" title="Cocina guiada">â–¶ï¸ Guiada</button>
              <button id="btnAddAll" class="btn btn-ghost" aria-label="AÃ±adir todos los ingredientes a la lista" title="AÃ±adir ingredientes">ğŸ§º AÃ±adir todo</button>
            </div>
          </div>
          <div>
            <h4 class="text-lg font-semibold">Ingredientes</h4>
            <ul id="detailIngredients" class="list-disc pl-6 mt-2"></ul>
            <h4 class="text-lg font-semibold mt-4">Pasos</h4>
            <ol id="detailSteps" class="list-decimal pl-6 mt-2"></ol>
          </div>
        </div>
      </div>
    </div>

    <div id="guidedModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 no-print" role="dialog" aria-modal="true" aria-labelledby="guidedTitle">
      <div class="card max-w-2xl w-full">
        <div class="p-3 border-b border-stone-200 dark:border-stone-700 flex items-center justify-between">
          <h3 id="guidedTitle" class="text-xl font-semibold">Cocina guiada</h3>
          <button id="closeGuided" class="btn btn-ghost" aria-label="Cerrar cocina guiada" title="Cerrar">âœ•</button>
        </div>
        <div class="p-4 space-y-4">
          <p class="text-sm text-stone-600 dark:text-stone-400">
            <strong>Voz manos libres activa.</strong> Di: â€œsiguienteâ€, â€œanteriorâ€, â€œrepetirâ€, â€œleer ingredientesâ€, â€œaÃ±adir ingredientesâ€, â€œleer receta completaâ€, â€œpaso 2â€, â€œcuÃ¡nto tiempoâ€, â€œquÃ© estoy haciendoâ€, â€œayudaâ€, â€œsalirâ€.
          </p>
          <div class="bg-stone-50 dark:bg-stone-900 rounded-xl p-4">
            <h4 id="guidedRecipeTitle" class="text-lg font-semibold mb-2"></h4>
            <ol id="guidedSteps" class="list-decimal pl-5 space-y-2"></ol>
          </div>
          <div class="flex items-center justify-between">
            <div class="text-xs text-stone-500" id="guidedProgress" aria-live="polite"></div>
            <div class="flex gap-2">
              <button id="prevStep" class="btn btn-ghost" aria-label="Paso anterior" title="Anterior">â† Anterior</button>
              <button id="repeatStep" class="btn btn-ghost" aria-label="Repetir paso" title="Repetir">âŸ² Repetir</button>
              <button id="nextStep" class="btn btn-primary" aria-label="Paso siguiente" title="Siguiente">Siguiente â†’</button>
              <button id="stopReading" class="btn btn-ghost" aria-label="Parar lectura" title="Parar">â–  Parar</button>
              <button id="printRecipe" class="btn btn-ghost" aria-label="Imprimir receta" title="Imprimir">ğŸ–¨ï¸ Imprimir</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <aside id="shoppingDrawer" class="drawer" aria-label="Lista de la compra" aria-hidden="true">
      <div class="p-3 border-b border-stone-200 dark:border-stone-700 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Lista de la compra</h3>
        <div class="flex items-center gap-2">
          <button id="exportList" class="btn btn-ghost" aria-label="Exportar lista" title="Exportar lista">â¬‡ï¸ Exportar</button>
          <button id="printList" class="btn btn-ghost" aria-label="Imprimir lista" title="Imprimir lista">ğŸ–¨ï¸</button>
          <button id="clearChecked" class="btn btn-ghost" aria-label="Borrar elementos marcados" title="Borrar marcados">ğŸ—‘ï¸ Marcados</button>
          <button id="closeShopping" class="btn btn-ghost" aria-label="Cerrar lista" title="Cerrar">âœ•</button>
        </div>
      </div>
      <div class="p-3">
        <div class="flex gap-2 mb-3">
          <label for="newItem" class="sr-only">Nuevo artÃ­culo</label>
          <input id="newItem" class="flex-1 rounded-xl border border-stone-300 dark:border-stone-700 bg-white dark:bg-stone-900 px-3 py-2" placeholder="AÃ±adir artÃ­culo (ej. 1 kg tomates)" />
          <button id="addItem" class="btn btn-primary" aria-label="AÃ±adir artÃ­culo" title="AÃ±adir artÃ­culo">AÃ±adir</button>
        </div>
        <ul id="shoppingList" class="space-y-2"></ul>
        <p id="shoppingEmpty" class="text-sm text-stone-500 mt-3 hidden">Tu lista estÃ¡ vacÃ­a.</p>
      </div>
    </aside>
  </div>

  <div id="ttsCaption" role="status" aria-live="polite"></div>

  <script>
/* ==========================
   ===== Datos (160 recetas) =====
   ========================== */
const APP_VERSION = "recetario-1.7.5"; 

// FUNCIONES BÃSICAS
function stripDiacritics(s){ try{ return (s||"").normalize('NFD').replace(/[\u0300-\u036f]/g,''); }catch{ return s||""; } }
const slug = s => stripDiacritics((s||"").toLowerCase()).replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
const sleep = ms => new Promise(r=>setTimeout(r,ms)); 

// IMG: usa placehold.co con el nombre del plato en la imagen y colores por categorÃ­a
const IMG = (cat, title) => {
  const text = encodeURIComponent(title);
  const baseByCat = {
    Aperitivo: "d62828/ffffff",
    Primero:   "f4a261/ffffff",
    Segundo:   "0077b6/ffffff",
    Postre:    "ef476f/ffffff"
  }[cat] || "78350f/ffffff";
  return `https://placehold.co/800x500/${baseByCat}?text=${text}`;
};

const APERITIVOS = [
  "Tostas de tomate y jamÃ³n","Tostas de anchoa y pimiento","Tostas de escalivada","Tostas de salmÃ³n y queso fresco",
  "Croquetas de jamÃ³n","Croquetas de pollo","Croquetas de bacalao","Croquetas de setas",
  "Empanadillas de atÃºn","Empanadillas de carne","Patatas bravas","Patatas alioli",
  "Boquerones en vinagre","ChampiÃ±ones al ajillo","Gildas donostiarras","Pinchos de tortilla",
  "Pinchos morunos","Queso marinado en aceite","Hummus clÃ¡sico con cruditÃ©s","Hummus de remolacha",
  "Hummus de aguacate","Gazpacho en vasitos","Salmorejo en chupitos","Ensaladilla rusa",
  "Tortilla francesa mini","Banderillas variadas","Mejillones en escabeche","Sardinas marinadas",
  "Pulpo a la gallega (tapa)","Calamares a la romana","Torreznos crujientes","JamÃ³n con picos",
  "Queso manchego con membrillo","Pimientos del padrÃ³n","Montadito de lomo","Montadito de pringÃ¡",
  "Bonito con tomate (tapa)","Pisto con huevo (tapa)","Chistorra a la sidra","Berenjena frita con miel"
];

const PRIMEROS = [
  "Sopa de ajo","Sopa castellana","Gazpacho andaluz","Salmorejo cordobÃ©s","Ajoblanco","Crema de calabaza",
  "Crema de puerros","Crema de champiÃ±Ã³n","Pisto manchego","Menestra de verduras","Lentejas estofadas",
  "Garbanzos con espinacas","JudÃ­as blancas con verduras","Arroz caldoso de verduras","Arroz a la cubana",
  "Arroz negro","Arroz al horno","Paella de verduras","FideuÃ¡ de pescado","Macarrones con tomate",
  "Tallarines al ajillo","Espaguetis carbonara ligera","Ensalada mixta","Ensalada campera","Ensalada de garbanzos",
  "Ensalada de pasta frÃ­a","Tomates aliÃ±ados","Papas arrugadas con mojo","Pimientos asados","Alcachofas salteadas",
  "Acelgas rehogadas","Sopa de pescado","Caldo gallego","Cocido andaluz (sopa)","Sopa minestrone","Vichyssoise",
  "Crema de zanahoria","Porrusalda","Sopa de marisco","Caldo de pollo casero"
];

const SEGUNDOS = [
  "Pollo al ajillo","Pollo al horno con patatas","Pollo en pepitoria","Pechuga de pollo a la plancha",
  "Escalope de ternera","Filete de ternera a la plancha","Carrilleras al vino tinto","Rabo de toro",
  "AlbÃ³ndigas en salsa","Lomo adobado","Costillas al horno","Chuletillas de cordero","Cordero asado",
  "Secreto ibÃ©rico a la plancha","Solomillo al roquefort","Bacalao a la vizcaÃ­na","Bacalao al pil-pil",
  "Merluza en salsa verde","Dorada al horno","Lubina a la sal","SalmÃ³n al papillote","AtÃºn encebollado",
  "Calamares en su tinta","Pulpo a la gallega","Paella mixta","Arroz con pollo","Arroz con bogavante",
  "Empanada gallega de atÃºn","Pisto con huevos","Tortilla de patatas","Revuelto de setas","Conejo al ajillo",
  "Codornices escabechadas","Callos a la madrileÃ±a","Fabada asturiana","Marmitako de bonito",
  "ChuletÃ³n a la plancha","Escabeche de caballa","Bonito con tomate","Trucha a la navarra"
];

const POSTRES = [
  "Flan casero","Natillas caseras","Arroz con leche","Leche frita","Torrijas","Crema catalana",
  "Tarta de queso al horno","Tarta de Santiago","Bizcocho de yogur","Bizcocho de naranja","Magdalenas caseras",
  "Galletas de mantequilla","Rosquillas fritas","PestiÃ±os","BuÃ±uelos de viento","Filloas","Peras al vino",
  "Compota de manzana","Macedonia de frutas","Helado rÃ¡pido de plÃ¡tano","Mousse de chocolate","Natillas de vainilla",
  "Tarta de manzana","Tarta tres leches (versiÃ³n)","Brazo de gitano","Quesada pasiega","Tocino de cielo",
  "Pan de Calatrava","Cuajada con miel","Crepes dulces","Flan de cafÃ©","Crema pastelera con frutas",
  "Tarta de almendra","Tarta de galletas con chocolate","Bizcocho marmolado","Helado de yogur","Brownie sencillo",
  "Crema de limÃ³n","Naranja con canela","Fresas con nata"
];

/* Overrides realistas para platos clave (ingredientes y pasos detallados) */
const OV = (()=> {
  function R(ing, pasos, tiempo){ return {ing, pasos, tiempo}; }
  const CROQ_BASE = ["Leche entera","Harina de trigo","Mantequilla","Aceite de oliva","Cebolla","Nuez moscada","Sal","Pimienta","Huevos","Pan rallado"];
  const CROQ_PASOS = [
    "Pica fino cebolla y el relleno.",
    "Pocha cebolla con aceite y mantequilla 6â€“8 min sin dorar.",
    "AÃ±ade el relleno y rehoga 1â€“2 min.",
    "Incorpora harina (90â€“100 g/L leche) y cocina 2â€“3 min.",
    "Agrega la leche caliente poco a poco, removiendo hasta bechamel espesa y lisa.",
    "Sazona con sal, pimienta y nuez moscada; cocina 8â€“10 min a fuego bajo.",
    "Pasa a fuente, filma a piel y enfrÃ­a 4 h (mejor de un dÃ­a para otro).",
    "Da forma, pasa por huevo y pan rallado.",
    "FrÃ­e a 175â€“180 ÂºC hasta dorar; escurre."
  ];
  const M = new Map([
    ["croquetas de jamÃ³n", R(["JamÃ³n serrano picado",...CROQ_BASE], CROQ_PASOS, "45â€“75 min + reposo")],
    ["croquetas de pollo", R(["Pollo cocido desmigado",...CROQ_BASE], CROQ_PASOS, "45â€“75 min + reposo")],
    ["croquetas de bacalao", R(["Bacalao desalado desmigado",...CROQ_BASE], CROQ_PASOS, "45â€“75 min + reposo")],
    ["croquetas de setas", R(["Setas picadas",...CROQ_BASE], CROQ_PASOS, "45â€“75 min + reposo")],
    ["patatas bravas", R(
      ["Patatas","Aceite para freÃ­r","Sal","Ajo","PimentÃ³n dulce","PimentÃ³n picante","Tomate triturado","Vinagre"],
      ["FrÃ­e patatas en dados hasta dorar.","SofrÃ­e ajo; aÃ±ade pimentÃ³n, tomate y sal.","Cocina 10â€“12 min y ajusta con vinagre.","Sirve patatas con salsa por encima."],
      "30â€“40 min"
    )],
    ["patatas alioli", R(
      ["Patatas cocidas","Ajo","Huevo o leche (lactonesa)","Aceite suave","LimÃ³n o vinagre","Sal","Perejil"],
      ["Cuece patatas y enfrÃ­a.","Emulsiona ajo con huevo/leche y aceite, sal y limÃ³n.","Mezcla patata en dados con alioli y perejil."],
      "25â€“35 min"
    )],
    ["calamares a la romana", R(
      ["Calamares","Harina","Huevo","Aceite para freÃ­r","Sal","L
