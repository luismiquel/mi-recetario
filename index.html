<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Recetario Español – 160 recetas</title>
  <meta name="description" content="Recetario Español con 160 recetas. Ingredientes, pasos detallados, búsqueda rápida, lista de la compra y asistente de voz.">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    body { -webkit-tap-highlight-color: transparent; }
    .card { border-radius: 1rem; border: 1px solid rgba(120,113,108,.25); overflow: hidden; background:#fff }
    .dark .card { background:#1f2937; border-color:#374151 }
    img { width:100%; height:12rem; object-fit:cover; }
    dialog { max-width: 600px; border: none; border-radius: 1rem; padding: 1rem; }
  </style>
</head>
<body class="bg-stone-50 dark:bg-stone-900 dark:text-stone-200">

  <header class="max-w-6xl mx-auto p-4 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold">Recetario Español – 160 recetas</h1>
      <p class="text-sm text-stone-600 dark:text-stone-400">Busca recetas · Voz manos libres · Lista de la compra</p>
    </div>
    <div class="flex gap-2">
      <button id="toggleTheme" class="px-3 py-1 rounded bg-stone-200 dark:bg-stone-700">🌙/☀️</button>
      <button id="openShopping" class="px-3 py-1 rounded bg-stone-200 dark:bg-stone-700">🧺</button>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4">
    <section class="mb-4">
      <input id="search" type="search" placeholder="Buscar receta..."
        class="w-full px-3 py-2 rounded border border-stone-300 dark:border-stone-700 dark:bg-stone-800">
    </section>
    <section id="recipesGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></section>
    <p id="emptyState" class="hidden text-center text-stone-500 mt-6">No hay resultados.</p>
  </main>

  <!-- Modal Receta Detallada -->
  <dialog id="recipeDialog">
    <article class="p-4">
      <h2 id="dlgTitulo" class="text-xl font-bold mb-2"></h2>
      <p id="dlgCategoria" class="text-sm text-stone-500 mb-2"></p>
      <p id="dlgTiempo" class="italic mb-3"></p>

      <h3 class="font-semibold">Ingredientes</h3>
      <ul id="dlgIngredientes" class="list-disc list-inside mb-3"></ul>

      <h3 class="font-semibold">Pasos</h3>
      <ol id="dlgPasos" class="list-decimal list-inside mb-3"></ol>

      <div class="flex gap-2">
        <button id="addToShopping" class="px-3 py-1 rounded bg-stone-200 dark:bg-stone-700">➕ Añadir ingredientes</button>
        <button id="speakRecipe" class="px-3 py-1 rounded bg-stone-200 dark:bg-stone-700">🔊 Leer en voz alta</button>
        <button id="closeDialog" class="px-3 py-1 rounded bg-red-500 text-white">Cerrar</button>
      </div>
    </article>
  </dialog>

  <!-- Drawer lista de la compra -->
  <aside id="shoppingDrawer" class="fixed top-0 right-0 w-80 max-w-full h-full bg-white dark:bg-stone-800 shadow-lg p-4 hidden">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-lg font-bold">Lista de la compra</h2>
      <button id="closeShopping">✕</button>
    </div>
    <ul id="shoppingList" class="space-y-2"></ul>
    <div class="mt-3 flex gap-2">
      <input id="newItem" class="flex-1 px-2 py-1 border rounded dark:bg-stone-700" placeholder="Añadir artículo">
      <button id="addItem" class="px-3 py-1 rounded bg-stone-200 dark:bg-stone-600">Añadir</button>
    </div>
  </aside>

  <!-- Incluimos el archivo de recetas -->
  <script src="recetas.js"></script>

  <script>
  // Generar URL de imagen (si no hay foto, placeholder)
  function imgURL(nombre) {
    return `https://placehold.co/800x500?text=${encodeURIComponent(nombre)}`;
  }

  // Render tarjetas
  function render(list) {
    const grid = document.getElementById("recipesGrid");
    const empty = document.getElementById("emptyState");
    if (!list.length) {
      grid.innerHTML = "";
      empty.classList.remove("hidden");
      return;
    }
    empty.classList.add("hidden");
    grid.innerHTML = list.map((r,idx) => `
      <article class="card cursor-pointer" onclick="openRecipe(${idx})">
        <img src="${imgURL(r.titulo)}" alt="Foto de ${r.titulo}">
        <div class="p-3">
          <h3 class="text-lg font-bold">${r.titulo}</h3>
          <p class="text-sm text-stone-500">${r.categoria} · ${r.tiempo || ""}</p>
        </div>
      </article>`).join("");
  }

  // Abrir receta detallada
  let currentRecipe = null;
  function openRecipe(idx){
    currentRecipe = filtered[idx];
    document.getElementById("dlgTitulo").textContent = currentRecipe.titulo;
    document.getElementById("dlgCategoria").textContent = currentRecipe.categoria;
    document.getElementById("dlgTiempo").textContent = "⏱️ " + (currentRecipe.tiempo || "");
    document.getElementById("dlgIngredientes").innerHTML = currentRecipe.ingredientes.map(i=>`<li>${i}</li>`).join("");
    document.getElementById("dlgPasos").innerHTML = currentRecipe.pasos.map(p=>`<li>${p}</li>`).join("");
    document.getElementById("recipeDialog").showModal();
  }

  // Cerrar receta
  document.getElementById("closeDialog").onclick = () => document.getElementById("recipeDialog").close();

  // Texto a voz
  document.getElementById("speakRecipe").onclick = () => {
    if (!currentRecipe) return;
    const msg = new SpeechSynthesisUtterance(
      `Receta: ${currentRecipe.titulo}. Ingredientes: ${currentRecipe.ingredientes.join(", ")}. Pasos: ${currentRecipe.pasos.join(". ")}.`
    );
    msg.lang = "es-ES";
    speechSynthesis.speak(msg);
  };

  // Lista de la compra
  let shopping = [];
  function renderList() {
    const ul = document.getElementById("shoppingList");
    ul.innerHTML = shopping.map((i,idx)=>`
      <li class="flex justify-between items-center">
        <span>${i}</span>
        <button onclick="removeItem(${idx})">🗑️</button>
      </li>`).join("");
  }
  function addItem(text) { if(text){ shopping.push(text); renderList(); } }
  function addMany(arr){ arr.forEach(addItem); openDrawer(); }
  function removeItem(i){ shopping.splice(i,1); renderList(); }
  document.getElementById("addItem").onclick = ()=>{ 
    const v=document.getElementById("newItem").value; 
    addItem(v); 
    document.getElementById("newItem").value="";
  };
  document.getElementById("addToShopping").onclick = ()=>{
    if(currentRecipe) addMany(currentRecipe.ingredientes);
  };

  // Drawer
  const drawer=document.getElementById("shoppingDrawer");
  function openDrawer(){ drawer.classList.remove("hidden"); }
  document.getElementById("openShopping").onclick=openDrawer;
  document.getElementById("closeShopping").onclick=()=>drawer.classList.add("hidden");

  // Tema oscuro
  document.getElementById("toggleTheme").onclick=()=>{
    document.documentElement.classList.toggle("dark");
  };

  // Búsqueda
  let filtered = RECETAS;
  document.getElementById("search").oninput = e => {
    const q = e.target.value.toLowerCase();
    filtered = RECETAS.filter(r => r.titulo.toLowerCase().includes(q));
    render(filtered);
  };

  // Inicial
  render(RECETAS);
  </script>
</body>
</html>
